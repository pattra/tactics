(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({"/Users/pattra/Documents/dev/GitHub/tactics/src/js/entities/charBattleDetail.js":[function(require,module,exports){
'use strict';

const CharBattleDetail = function (game, x, y, properties) {
  this.vitals = game.add.group();
  this.vitals.visible = false;
  this.text = {};
  this.handler = properties.actionHandler;

  const style = { font: '24px Arial', fill: '#ff0044' };

  /* full detail panel */
  this.text.name = game.add.text(0, game.world.centerY, properties.name, style, this.vitals);
  this.text.hp = game.add.text(0, game.world.centerY + 50, properties.maxHP + '/' + properties.maxHP, style, this.vitals);

  /* actions */
  this.text.move = game.add.text(0, game.world.centerY + 100, 'Move Character', style, this.vitals);
  this.text.move.inputEnabled = true;
  this.text.move.events.onInputDown.add(() => { this.handler('move', { loc: properties.loc }); });

  this.toggleDisplay = () => {
    this.vitals.visible = !this.vitals.visible;
  };

  this.updateHP = (current, max) => {
    this.text.hp.setText(current + '/' + max);
  };
};

CharBattleDetail.prototype.constructor = CharBattleDetail;

/**
 * Automatically called by World.update
 */
CharBattleDetail.prototype.update = function () {
};

module.exports = CharBattleDetail;

},{}],"/Users/pattra/Documents/dev/GitHub/tactics/src/js/entities/charBattlePreview.js":[function(require,module,exports){
'use strict';

const CharBattlePreview = function (game, x, y, properties) {
  this.vitals = game.add.group();
  this.vitals.visible = false;
  this.text = {};

  const style = { font: '24px Arial', fill: '#ff0044' };

  /* preview panel */
  this.text.name = game.add.text(game.world.centerX, game.world.centerY, properties.name, style, this.vitals);
  this.text.hp = game.add.text(game.world.centerX, game.world.centerY + 50, properties.maxHP + '/' + properties.maxHP, style, this.vitals);

  this.toggleDisplay = (cursorOn) => {
    this.vitals.visible = cursorOn;
  };

  this.updateHP = (current, max) => {
    this.text.hp.setText(current + '/' + max);
  };
};

CharBattlePreview.prototype.constructor = CharBattlePreview;

/**
 * Automatically called by World.update
 */
CharBattlePreview.prototype.update = function () {
};

module.exports = CharBattlePreview;

},{}],"/Users/pattra/Documents/dev/GitHub/tactics/src/js/entities/character.js":[function(require,module,exports){
'use strict';

const Preview = require('../entities/charBattlePreview');
const Detail = require('../entities/charBattleDetail');

const Character = function (game, x, y, properties) {
  /* PROPERTIES */
  this.preview = new Preview(game, x, y, properties);
  this.detail = new Detail(game, x, y, properties);
  this.name = properties.name;
  this.loc = properties.loc;
  this.maxHP = properties.maxHP;
  this.currentHP = properties.maxHP;

  /* FUNCTIONS */
  this.onHover = (cursorOn) => {
    this.preview.toggleDisplay(cursorOn);
  };

  this.toggleSelect = () => {
    this.detail.toggleDisplay();
  };

  this.changeHP = (amt) => {
    this.currentHP = this.currentHP + amt;
    this.preview.updateHP(this.currentHP, this.maxHP);
    this.detail.updateHP(this.currentHP, this.maxHP);
  };

  this.changeLoc = (loc, x, y) => {
    console.log('updating', this.name, loc, x, y);
    this.loc = loc;
    this.x = x;
    this.y = y;
  };

  Phaser.Sprite.call(this, game, x, y, properties.sprite);
  game.add.existing(this);
};

Character.prototype = Object.create(Phaser.Sprite.prototype);
Character.prototype.constructor = Character;

/**
 * Automatically called by World.update
 */
Character.prototype.update = function () {
};

module.exports = Character;

},{"../entities/charBattleDetail":"/Users/pattra/Documents/dev/GitHub/tactics/src/js/entities/charBattleDetail.js","../entities/charBattlePreview":"/Users/pattra/Documents/dev/GitHub/tactics/src/js/entities/charBattlePreview.js"}],"/Users/pattra/Documents/dev/GitHub/tactics/src/js/entities/tile.js":[function(require,module,exports){
'use strict';

const Tile = function (game, x, y) {
  this.status = 'default';
  this.defaultState = 'grass';

  this.setStatus = (frameName, status) => {
    this.frameName = frameName === 'default' ? this.defaultState : frameName;
    this.status = status ? status : frameName;
  };

  Phaser.Sprite.call(this, game, x, y, 'tiles', 'grass');
  game.add.existing(this);
};

Tile.prototype = Object.create(Phaser.Sprite.prototype);
Tile.prototype.constructor = Tile;

Tile.prototype.update = function () {
};

module.exports = Tile;

},{}],"/Users/pattra/Documents/dev/GitHub/tactics/src/js/main.js":[function(require,module,exports){
'use strict';

var game = new Phaser.Game(800, 600, Phaser.AUTO, 'tactics-game');

window.Utils = require('./utils');
window.playerState = {
  currentLevel: 'Game',
};

game.state.add('Boot', require('./states/boot'));
game.state.add('Splash', require('./states/splash'));
game.state.add('Preloader', require('./states/preloader'));
game.state.add('Menu', require('./states/menu'));
game.state.add('Game', require('./states/game'));

game.state.start('Boot');

},{"./states/boot":"/Users/pattra/Documents/dev/GitHub/tactics/src/js/states/boot.js","./states/game":"/Users/pattra/Documents/dev/GitHub/tactics/src/js/states/game.js","./states/menu":"/Users/pattra/Documents/dev/GitHub/tactics/src/js/states/menu.js","./states/preloader":"/Users/pattra/Documents/dev/GitHub/tactics/src/js/states/preloader.js","./states/splash":"/Users/pattra/Documents/dev/GitHub/tactics/src/js/states/splash.js","./utils":"/Users/pattra/Documents/dev/GitHub/tactics/src/js/utils.js"}],"/Users/pattra/Documents/dev/GitHub/tactics/src/js/states/boot.js":[function(require,module,exports){
var Boot = function () {};

module.exports = Boot;

Boot.prototype = {

  preload: function () {
    this.load.image('preloader', 'assets/preloader.gif');
  },

  create: function () {
    this.game.input.maxPointers = 1;

    if (this.game.device.desktop) {
      this.game.stage.scale.pageAlignHorizontally = true;
    } else {
      this.game.scale.scaleMode = Phaser.ScaleManager.SHOW_ALL;
      this.game.scale.minWidth =  480;
      this.game.scale.minHeight = 260;
      this.game.scale.maxWidth = 640;
      this.game.scale.maxHeight = 480;
      this.game.scale.forceLandscape = true;
      this.game.scale.pageAlignHorizontally = true;
      this.game.scale.setScreenSize(true);
    }

    this.game.state.start('Preloader');
  }
};

},{}],"/Users/pattra/Documents/dev/GitHub/tactics/src/js/states/game.js":[function(require,module,exports){
'use strict';

const Character = require('../entities/character');
const Tile = require('../entities/tile');

const MAP_SIZE = 3;
const MAP_TOTAL_TILES = 9;

const PLAYER_FILE = {
  party: [
    {
      name: 'Sobel',
      maxHP: 10,
      isPlayer: true,
      defaultLoc: 3,
      loc: 3,
    },
    {
      name: 'Fenris',
      maxHP: 15,
      defaultLoc: 5,
      loc: 5,
    },
    {
      name: 'Corrin',
      maxHP: 15,
      defaultLoc: 2,
      loc: 2,
    },
  ],
};

const Game = function () {
  this.charFocus = null;
  this.playerMap = [];
  this.enemyMap = [];
};

module.exports = Game;

Game.prototype = {

  init: function (param) {
    // console.log(param);
  },

  create: function () {
    const mapOffset = 400;
    let i;
    let j;

    /* INIT TILES */
    for (i = 0; i < MAP_SIZE; i++) {
      for (j = 0; j < MAP_SIZE; j++) {
        let playerTile;
        let enemyTile;

        // player tiles
        playerTile = new Tile(this.game, j * 100, i * 100);
        this.playerMap.push({
          tile: playerTile,
          x: j * 100,
          y: i * 100,
        });

        // enemy tiles
        enemyTile = new Tile(this.game, j * 100 + mapOffset, i * 100);
        this.enemyMap.push({
          tile: enemyTile,
          x: j * 100,
          y: i * 100,
        });
      }
    }

    /* INIT CHARACTERS */
    PLAYER_FILE.party.forEach((char, index) => {
      // TODO: error checking for location overlaps
      let slot = this.playerMap[char.defaultLoc];
      slot.character = new Character(this.game, slot.x, slot.y, Object.assign(char, {
        team: 'ally',
        sprite: 'ally',
        actionHandler: this._actionHandler.bind(this),
      }));

      slot.character.inputEnabled = true;
      slot.character.events.onInputOver.add(() => { slot.character.onHover(true); });
      slot.character.events.onInputOut.add(() => { slot.character.onHover(false); });
      slot.character.events.onInputDown.add(() => { this.selectCharacter(slot.character); });
    });
  },

  update: function () {

  },

  onInputDown: function () {
    this.game.state.start('Menu');
  },

  selectCharacter: function (character) {
    if (this.charFocus && this.charFocus !== character.loc
        && this.playerMap[this.charFocus].character !== character) {
      this.playerMap[this.charFocus].character.toggleSelect();
    }

    if (this.charFocus && this.playerMap[this.charFocus].character === character) {
      this.charFocus = null;
    } else {
      this.charFocus = character.loc;
    }

    character.toggleSelect();
  },

  _enableMove: function (loc) {
    const char = this.playerMap[loc].character;
    this.playerMap.forEach((val, index) => {
      val.tile.inputEnabled = true;
      if (val.character) val.character.inputEnabled = false;

      val.tile.setStatus('selectable');
      val.tile.events.onInputDown.add(() => { this._selectTile('move', loc, index); });
    });
  },

  _selectTile: function (action, origin, target) {
    const originSlot = this.playerMap[origin];
    const targetSlot = this.playerMap[target];

    if (action === 'move') {
      const char = originSlot.character;
      const swapChar = targetSlot.character;
      char.changeLoc(target, targetSlot.x, targetSlot.y);
      if (swapChar) swapChar.changeLoc(origin, originSlot.x, originSlot.y);

      this.playerMap.forEach((val) => {
        val.tile.setStatus('default');
        if (val.character) {
          val.character.inputEnabled = true;
          val.character.onHover(false);
        }
      });
    }
  },

  _actionHandler: function (action, params) {
    if (action === 'move') {
      this._enableMove(params.loc);
    }
  },
};

},{"../entities/character":"/Users/pattra/Documents/dev/GitHub/tactics/src/js/entities/character.js","../entities/tile":"/Users/pattra/Documents/dev/GitHub/tactics/src/js/entities/tile.js"}],"/Users/pattra/Documents/dev/GitHub/tactics/src/js/states/menu.js":[function(require,module,exports){
var Menu = function () {
  this.text = null;
};

module.exports = Menu;

Menu.prototype = {

  create: function () {
    var x = this.game.width / 2;
    var y = this.game.height / 2;

    var style = { font: "65px Arial", fill: "#ffffff", align: "center" };

    this.text = this.add.text(x - 300, y - 200, "Press to Start", style);

    this.input.onDown.add(this.onDown, this);
  },

  update: function () {
  },

  onDown: function () {
    this.game.state.start(playerState.currentLevel);
  }
};

},{}],"/Users/pattra/Documents/dev/GitHub/tactics/src/js/states/preloader.js":[function(require,module,exports){
var Preloader = function (game) {
  this.asset = null;
  this.ready = false;
};

module.exports = Preloader;

Preloader.prototype = {

  preload: function () {
    this.asset = this.add.sprite(320, 240, 'preloader');
    this.asset.anchor.setTo(0.5, 0.5);

    this.load.onLoadComplete.addOnce(this.onLoadComplete, this);
    this.load.setPreloadSprite(this.asset);

    /* loading sprites */
    this.load.image('ally', 'assets/ally.png');
    this.load.image('enemy', 'assets/enemy.png');

    /* loading texture atlases */
    this.load.atlasJSONHash('tiles', 'assets/tiles.png', 'assets/tiles.json');
  },

  create: function () {
    this.asset.cropEnabled = false;
  },

  update: function () {
    if (!!this.ready) {
      this.game.state.start('Game', true, false, { test: 1 });
    }
  },

  onLoadComplete: function () {
    this.ready = true;
  },
};

},{}],"/Users/pattra/Documents/dev/GitHub/tactics/src/js/states/splash.js":[function(require,module,exports){
var Splash = function () {
};

module.exports = Splash;

Splash.prototype = {
  create: function () {
  }
};
},{}],"/Users/pattra/Documents/dev/GitHub/tactics/src/js/utils.js":[function(require,module,exports){
var Utils = {
    containsObject: function(obj, list) {
        var i;
        for (i = 0; i < list.length; i++) {
            if (list[i] === obj) {
                return true;
            }
        }

        return false;
    }
};

module.exports = Utils;
},{}]},{},["/Users/pattra/Documents/dev/GitHub/tactics/src/js/main.js"])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvanMvZW50aXRpZXMvY2hhckJhdHRsZURldGFpbC5qcyIsInNyYy9qcy9lbnRpdGllcy9jaGFyQmF0dGxlUHJldmlldy5qcyIsInNyYy9qcy9lbnRpdGllcy9jaGFyYWN0ZXIuanMiLCJzcmMvanMvZW50aXRpZXMvdGlsZS5qcyIsInNyYy9qcy9tYWluLmpzIiwic3JjL2pzL3N0YXRlcy9ib290LmpzIiwic3JjL2pzL3N0YXRlcy9nYW1lLmpzIiwic3JjL2pzL3N0YXRlcy9tZW51LmpzIiwic3JjL2pzL3N0YXRlcy9wcmVsb2FkZXIuanMiLCJzcmMvanMvc3RhdGVzL3NwbGFzaC5qcyIsInNyYy9qcy91dGlscy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQ0FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDckNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDL0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNsREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN0QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzdCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDeEpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMxQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3RDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDUkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCIndXNlIHN0cmljdCc7XG5cbmNvbnN0IENoYXJCYXR0bGVEZXRhaWwgPSBmdW5jdGlvbiAoZ2FtZSwgeCwgeSwgcHJvcGVydGllcykge1xuICB0aGlzLnZpdGFscyA9IGdhbWUuYWRkLmdyb3VwKCk7XG4gIHRoaXMudml0YWxzLnZpc2libGUgPSBmYWxzZTtcbiAgdGhpcy50ZXh0ID0ge307XG4gIHRoaXMuaGFuZGxlciA9IHByb3BlcnRpZXMuYWN0aW9uSGFuZGxlcjtcblxuICBjb25zdCBzdHlsZSA9IHsgZm9udDogJzI0cHggQXJpYWwnLCBmaWxsOiAnI2ZmMDA0NCcgfTtcblxuICAvKiBmdWxsIGRldGFpbCBwYW5lbCAqL1xuICB0aGlzLnRleHQubmFtZSA9IGdhbWUuYWRkLnRleHQoMCwgZ2FtZS53b3JsZC5jZW50ZXJZLCBwcm9wZXJ0aWVzLm5hbWUsIHN0eWxlLCB0aGlzLnZpdGFscyk7XG4gIHRoaXMudGV4dC5ocCA9IGdhbWUuYWRkLnRleHQoMCwgZ2FtZS53b3JsZC5jZW50ZXJZICsgNTAsIHByb3BlcnRpZXMubWF4SFAgKyAnLycgKyBwcm9wZXJ0aWVzLm1heEhQLCBzdHlsZSwgdGhpcy52aXRhbHMpO1xuXG4gIC8qIGFjdGlvbnMgKi9cbiAgdGhpcy50ZXh0Lm1vdmUgPSBnYW1lLmFkZC50ZXh0KDAsIGdhbWUud29ybGQuY2VudGVyWSArIDEwMCwgJ01vdmUgQ2hhcmFjdGVyJywgc3R5bGUsIHRoaXMudml0YWxzKTtcbiAgdGhpcy50ZXh0Lm1vdmUuaW5wdXRFbmFibGVkID0gdHJ1ZTtcbiAgdGhpcy50ZXh0Lm1vdmUuZXZlbnRzLm9uSW5wdXREb3duLmFkZCgoKSA9PiB7IHRoaXMuaGFuZGxlcignbW92ZScsIHsgbG9jOiBwcm9wZXJ0aWVzLmxvYyB9KTsgfSk7XG5cbiAgdGhpcy50b2dnbGVEaXNwbGF5ID0gKCkgPT4ge1xuICAgIHRoaXMudml0YWxzLnZpc2libGUgPSAhdGhpcy52aXRhbHMudmlzaWJsZTtcbiAgfTtcblxuICB0aGlzLnVwZGF0ZUhQID0gKGN1cnJlbnQsIG1heCkgPT4ge1xuICAgIHRoaXMudGV4dC5ocC5zZXRUZXh0KGN1cnJlbnQgKyAnLycgKyBtYXgpO1xuICB9O1xufTtcblxuQ2hhckJhdHRsZURldGFpbC5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBDaGFyQmF0dGxlRGV0YWlsO1xuXG4vKipcbiAqIEF1dG9tYXRpY2FsbHkgY2FsbGVkIGJ5IFdvcmxkLnVwZGF0ZVxuICovXG5DaGFyQmF0dGxlRGV0YWlsLnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbiAoKSB7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IENoYXJCYXR0bGVEZXRhaWw7XG4iLCIndXNlIHN0cmljdCc7XG5cbmNvbnN0IENoYXJCYXR0bGVQcmV2aWV3ID0gZnVuY3Rpb24gKGdhbWUsIHgsIHksIHByb3BlcnRpZXMpIHtcbiAgdGhpcy52aXRhbHMgPSBnYW1lLmFkZC5ncm91cCgpO1xuICB0aGlzLnZpdGFscy52aXNpYmxlID0gZmFsc2U7XG4gIHRoaXMudGV4dCA9IHt9O1xuXG4gIGNvbnN0IHN0eWxlID0geyBmb250OiAnMjRweCBBcmlhbCcsIGZpbGw6ICcjZmYwMDQ0JyB9O1xuXG4gIC8qIHByZXZpZXcgcGFuZWwgKi9cbiAgdGhpcy50ZXh0Lm5hbWUgPSBnYW1lLmFkZC50ZXh0KGdhbWUud29ybGQuY2VudGVyWCwgZ2FtZS53b3JsZC5jZW50ZXJZLCBwcm9wZXJ0aWVzLm5hbWUsIHN0eWxlLCB0aGlzLnZpdGFscyk7XG4gIHRoaXMudGV4dC5ocCA9IGdhbWUuYWRkLnRleHQoZ2FtZS53b3JsZC5jZW50ZXJYLCBnYW1lLndvcmxkLmNlbnRlclkgKyA1MCwgcHJvcGVydGllcy5tYXhIUCArICcvJyArIHByb3BlcnRpZXMubWF4SFAsIHN0eWxlLCB0aGlzLnZpdGFscyk7XG5cbiAgdGhpcy50b2dnbGVEaXNwbGF5ID0gKGN1cnNvck9uKSA9PiB7XG4gICAgdGhpcy52aXRhbHMudmlzaWJsZSA9IGN1cnNvck9uO1xuICB9O1xuXG4gIHRoaXMudXBkYXRlSFAgPSAoY3VycmVudCwgbWF4KSA9PiB7XG4gICAgdGhpcy50ZXh0LmhwLnNldFRleHQoY3VycmVudCArICcvJyArIG1heCk7XG4gIH07XG59O1xuXG5DaGFyQmF0dGxlUHJldmlldy5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBDaGFyQmF0dGxlUHJldmlldztcblxuLyoqXG4gKiBBdXRvbWF0aWNhbGx5IGNhbGxlZCBieSBXb3JsZC51cGRhdGVcbiAqL1xuQ2hhckJhdHRsZVByZXZpZXcucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gQ2hhckJhdHRsZVByZXZpZXc7XG4iLCIndXNlIHN0cmljdCc7XG5cbmNvbnN0IFByZXZpZXcgPSByZXF1aXJlKCcuLi9lbnRpdGllcy9jaGFyQmF0dGxlUHJldmlldycpO1xuY29uc3QgRGV0YWlsID0gcmVxdWlyZSgnLi4vZW50aXRpZXMvY2hhckJhdHRsZURldGFpbCcpO1xuXG5jb25zdCBDaGFyYWN0ZXIgPSBmdW5jdGlvbiAoZ2FtZSwgeCwgeSwgcHJvcGVydGllcykge1xuICAvKiBQUk9QRVJUSUVTICovXG4gIHRoaXMucHJldmlldyA9IG5ldyBQcmV2aWV3KGdhbWUsIHgsIHksIHByb3BlcnRpZXMpO1xuICB0aGlzLmRldGFpbCA9IG5ldyBEZXRhaWwoZ2FtZSwgeCwgeSwgcHJvcGVydGllcyk7XG4gIHRoaXMubmFtZSA9IHByb3BlcnRpZXMubmFtZTtcbiAgdGhpcy5sb2MgPSBwcm9wZXJ0aWVzLmxvYztcbiAgdGhpcy5tYXhIUCA9IHByb3BlcnRpZXMubWF4SFA7XG4gIHRoaXMuY3VycmVudEhQID0gcHJvcGVydGllcy5tYXhIUDtcblxuICAvKiBGVU5DVElPTlMgKi9cbiAgdGhpcy5vbkhvdmVyID0gKGN1cnNvck9uKSA9PiB7XG4gICAgdGhpcy5wcmV2aWV3LnRvZ2dsZURpc3BsYXkoY3Vyc29yT24pO1xuICB9O1xuXG4gIHRoaXMudG9nZ2xlU2VsZWN0ID0gKCkgPT4ge1xuICAgIHRoaXMuZGV0YWlsLnRvZ2dsZURpc3BsYXkoKTtcbiAgfTtcblxuICB0aGlzLmNoYW5nZUhQID0gKGFtdCkgPT4ge1xuICAgIHRoaXMuY3VycmVudEhQID0gdGhpcy5jdXJyZW50SFAgKyBhbXQ7XG4gICAgdGhpcy5wcmV2aWV3LnVwZGF0ZUhQKHRoaXMuY3VycmVudEhQLCB0aGlzLm1heEhQKTtcbiAgICB0aGlzLmRldGFpbC51cGRhdGVIUCh0aGlzLmN1cnJlbnRIUCwgdGhpcy5tYXhIUCk7XG4gIH07XG5cbiAgdGhpcy5jaGFuZ2VMb2MgPSAobG9jLCB4LCB5KSA9PiB7XG4gICAgY29uc29sZS5sb2coJ3VwZGF0aW5nJywgdGhpcy5uYW1lLCBsb2MsIHgsIHkpO1xuICAgIHRoaXMubG9jID0gbG9jO1xuICAgIHRoaXMueCA9IHg7XG4gICAgdGhpcy55ID0geTtcbiAgfTtcblxuICBQaGFzZXIuU3ByaXRlLmNhbGwodGhpcywgZ2FtZSwgeCwgeSwgcHJvcGVydGllcy5zcHJpdGUpO1xuICBnYW1lLmFkZC5leGlzdGluZyh0aGlzKTtcbn07XG5cbkNoYXJhY3Rlci5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKFBoYXNlci5TcHJpdGUucHJvdG90eXBlKTtcbkNoYXJhY3Rlci5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBDaGFyYWN0ZXI7XG5cbi8qKlxuICogQXV0b21hdGljYWxseSBjYWxsZWQgYnkgV29ybGQudXBkYXRlXG4gKi9cbkNoYXJhY3Rlci5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24gKCkge1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBDaGFyYWN0ZXI7XG4iLCIndXNlIHN0cmljdCc7XG5cbmNvbnN0IFRpbGUgPSBmdW5jdGlvbiAoZ2FtZSwgeCwgeSkge1xuICB0aGlzLnN0YXR1cyA9ICdkZWZhdWx0JztcbiAgdGhpcy5kZWZhdWx0U3RhdGUgPSAnZ3Jhc3MnO1xuXG4gIHRoaXMuc2V0U3RhdHVzID0gKGZyYW1lTmFtZSwgc3RhdHVzKSA9PiB7XG4gICAgdGhpcy5mcmFtZU5hbWUgPSBmcmFtZU5hbWUgPT09ICdkZWZhdWx0JyA/IHRoaXMuZGVmYXVsdFN0YXRlIDogZnJhbWVOYW1lO1xuICAgIHRoaXMuc3RhdHVzID0gc3RhdHVzID8gc3RhdHVzIDogZnJhbWVOYW1lO1xuICB9O1xuXG4gIFBoYXNlci5TcHJpdGUuY2FsbCh0aGlzLCBnYW1lLCB4LCB5LCAndGlsZXMnLCAnZ3Jhc3MnKTtcbiAgZ2FtZS5hZGQuZXhpc3RpbmcodGhpcyk7XG59O1xuXG5UaWxlLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoUGhhc2VyLlNwcml0ZS5wcm90b3R5cGUpO1xuVGlsZS5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBUaWxlO1xuXG5UaWxlLnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbiAoKSB7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFRpbGU7XG4iLCIndXNlIHN0cmljdCc7XG5cbnZhciBnYW1lID0gbmV3IFBoYXNlci5HYW1lKDgwMCwgNjAwLCBQaGFzZXIuQVVUTywgJ3RhY3RpY3MtZ2FtZScpO1xuXG53aW5kb3cuVXRpbHMgPSByZXF1aXJlKCcuL3V0aWxzJyk7XG53aW5kb3cucGxheWVyU3RhdGUgPSB7XG4gIGN1cnJlbnRMZXZlbDogJ0dhbWUnLFxufTtcblxuZ2FtZS5zdGF0ZS5hZGQoJ0Jvb3QnLCByZXF1aXJlKCcuL3N0YXRlcy9ib290JykpO1xuZ2FtZS5zdGF0ZS5hZGQoJ1NwbGFzaCcsIHJlcXVpcmUoJy4vc3RhdGVzL3NwbGFzaCcpKTtcbmdhbWUuc3RhdGUuYWRkKCdQcmVsb2FkZXInLCByZXF1aXJlKCcuL3N0YXRlcy9wcmVsb2FkZXInKSk7XG5nYW1lLnN0YXRlLmFkZCgnTWVudScsIHJlcXVpcmUoJy4vc3RhdGVzL21lbnUnKSk7XG5nYW1lLnN0YXRlLmFkZCgnR2FtZScsIHJlcXVpcmUoJy4vc3RhdGVzL2dhbWUnKSk7XG5cbmdhbWUuc3RhdGUuc3RhcnQoJ0Jvb3QnKTtcbiIsInZhciBCb290ID0gZnVuY3Rpb24gKCkge307XG5cbm1vZHVsZS5leHBvcnRzID0gQm9vdDtcblxuQm9vdC5wcm90b3R5cGUgPSB7XG5cbiAgcHJlbG9hZDogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMubG9hZC5pbWFnZSgncHJlbG9hZGVyJywgJ2Fzc2V0cy9wcmVsb2FkZXIuZ2lmJyk7XG4gIH0sXG5cbiAgY3JlYXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5nYW1lLmlucHV0Lm1heFBvaW50ZXJzID0gMTtcblxuICAgIGlmICh0aGlzLmdhbWUuZGV2aWNlLmRlc2t0b3ApIHtcbiAgICAgIHRoaXMuZ2FtZS5zdGFnZS5zY2FsZS5wYWdlQWxpZ25Ib3Jpem9udGFsbHkgPSB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmdhbWUuc2NhbGUuc2NhbGVNb2RlID0gUGhhc2VyLlNjYWxlTWFuYWdlci5TSE9XX0FMTDtcbiAgICAgIHRoaXMuZ2FtZS5zY2FsZS5taW5XaWR0aCA9ICA0ODA7XG4gICAgICB0aGlzLmdhbWUuc2NhbGUubWluSGVpZ2h0ID0gMjYwO1xuICAgICAgdGhpcy5nYW1lLnNjYWxlLm1heFdpZHRoID0gNjQwO1xuICAgICAgdGhpcy5nYW1lLnNjYWxlLm1heEhlaWdodCA9IDQ4MDtcbiAgICAgIHRoaXMuZ2FtZS5zY2FsZS5mb3JjZUxhbmRzY2FwZSA9IHRydWU7XG4gICAgICB0aGlzLmdhbWUuc2NhbGUucGFnZUFsaWduSG9yaXpvbnRhbGx5ID0gdHJ1ZTtcbiAgICAgIHRoaXMuZ2FtZS5zY2FsZS5zZXRTY3JlZW5TaXplKHRydWUpO1xuICAgIH1cblxuICAgIHRoaXMuZ2FtZS5zdGF0ZS5zdGFydCgnUHJlbG9hZGVyJyk7XG4gIH1cbn07XG4iLCIndXNlIHN0cmljdCc7XG5cbmNvbnN0IENoYXJhY3RlciA9IHJlcXVpcmUoJy4uL2VudGl0aWVzL2NoYXJhY3RlcicpO1xuY29uc3QgVGlsZSA9IHJlcXVpcmUoJy4uL2VudGl0aWVzL3RpbGUnKTtcblxuY29uc3QgTUFQX1NJWkUgPSAzO1xuY29uc3QgTUFQX1RPVEFMX1RJTEVTID0gOTtcblxuY29uc3QgUExBWUVSX0ZJTEUgPSB7XG4gIHBhcnR5OiBbXG4gICAge1xuICAgICAgbmFtZTogJ1NvYmVsJyxcbiAgICAgIG1heEhQOiAxMCxcbiAgICAgIGlzUGxheWVyOiB0cnVlLFxuICAgICAgZGVmYXVsdExvYzogMyxcbiAgICAgIGxvYzogMyxcbiAgICB9LFxuICAgIHtcbiAgICAgIG5hbWU6ICdGZW5yaXMnLFxuICAgICAgbWF4SFA6IDE1LFxuICAgICAgZGVmYXVsdExvYzogNSxcbiAgICAgIGxvYzogNSxcbiAgICB9LFxuICAgIHtcbiAgICAgIG5hbWU6ICdDb3JyaW4nLFxuICAgICAgbWF4SFA6IDE1LFxuICAgICAgZGVmYXVsdExvYzogMixcbiAgICAgIGxvYzogMixcbiAgICB9LFxuICBdLFxufTtcblxuY29uc3QgR2FtZSA9IGZ1bmN0aW9uICgpIHtcbiAgdGhpcy5jaGFyRm9jdXMgPSBudWxsO1xuICB0aGlzLnBsYXllck1hcCA9IFtdO1xuICB0aGlzLmVuZW15TWFwID0gW107XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IEdhbWU7XG5cbkdhbWUucHJvdG90eXBlID0ge1xuXG4gIGluaXQ6IGZ1bmN0aW9uIChwYXJhbSkge1xuICAgIC8vIGNvbnNvbGUubG9nKHBhcmFtKTtcbiAgfSxcblxuICBjcmVhdGU6IGZ1bmN0aW9uICgpIHtcbiAgICBjb25zdCBtYXBPZmZzZXQgPSA0MDA7XG4gICAgbGV0IGk7XG4gICAgbGV0IGo7XG5cbiAgICAvKiBJTklUIFRJTEVTICovXG4gICAgZm9yIChpID0gMDsgaSA8IE1BUF9TSVpFOyBpKyspIHtcbiAgICAgIGZvciAoaiA9IDA7IGogPCBNQVBfU0laRTsgaisrKSB7XG4gICAgICAgIGxldCBwbGF5ZXJUaWxlO1xuICAgICAgICBsZXQgZW5lbXlUaWxlO1xuXG4gICAgICAgIC8vIHBsYXllciB0aWxlc1xuICAgICAgICBwbGF5ZXJUaWxlID0gbmV3IFRpbGUodGhpcy5nYW1lLCBqICogMTAwLCBpICogMTAwKTtcbiAgICAgICAgdGhpcy5wbGF5ZXJNYXAucHVzaCh7XG4gICAgICAgICAgdGlsZTogcGxheWVyVGlsZSxcbiAgICAgICAgICB4OiBqICogMTAwLFxuICAgICAgICAgIHk6IGkgKiAxMDAsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIGVuZW15IHRpbGVzXG4gICAgICAgIGVuZW15VGlsZSA9IG5ldyBUaWxlKHRoaXMuZ2FtZSwgaiAqIDEwMCArIG1hcE9mZnNldCwgaSAqIDEwMCk7XG4gICAgICAgIHRoaXMuZW5lbXlNYXAucHVzaCh7XG4gICAgICAgICAgdGlsZTogZW5lbXlUaWxlLFxuICAgICAgICAgIHg6IGogKiAxMDAsXG4gICAgICAgICAgeTogaSAqIDEwMCxcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLyogSU5JVCBDSEFSQUNURVJTICovXG4gICAgUExBWUVSX0ZJTEUucGFydHkuZm9yRWFjaCgoY2hhciwgaW5kZXgpID0+IHtcbiAgICAgIC8vIFRPRE86IGVycm9yIGNoZWNraW5nIGZvciBsb2NhdGlvbiBvdmVybGFwc1xuICAgICAgbGV0IHNsb3QgPSB0aGlzLnBsYXllck1hcFtjaGFyLmRlZmF1bHRMb2NdO1xuICAgICAgc2xvdC5jaGFyYWN0ZXIgPSBuZXcgQ2hhcmFjdGVyKHRoaXMuZ2FtZSwgc2xvdC54LCBzbG90LnksIE9iamVjdC5hc3NpZ24oY2hhciwge1xuICAgICAgICB0ZWFtOiAnYWxseScsXG4gICAgICAgIHNwcml0ZTogJ2FsbHknLFxuICAgICAgICBhY3Rpb25IYW5kbGVyOiB0aGlzLl9hY3Rpb25IYW5kbGVyLmJpbmQodGhpcyksXG4gICAgICB9KSk7XG5cbiAgICAgIHNsb3QuY2hhcmFjdGVyLmlucHV0RW5hYmxlZCA9IHRydWU7XG4gICAgICBzbG90LmNoYXJhY3Rlci5ldmVudHMub25JbnB1dE92ZXIuYWRkKCgpID0+IHsgc2xvdC5jaGFyYWN0ZXIub25Ib3Zlcih0cnVlKTsgfSk7XG4gICAgICBzbG90LmNoYXJhY3Rlci5ldmVudHMub25JbnB1dE91dC5hZGQoKCkgPT4geyBzbG90LmNoYXJhY3Rlci5vbkhvdmVyKGZhbHNlKTsgfSk7XG4gICAgICBzbG90LmNoYXJhY3Rlci5ldmVudHMub25JbnB1dERvd24uYWRkKCgpID0+IHsgdGhpcy5zZWxlY3RDaGFyYWN0ZXIoc2xvdC5jaGFyYWN0ZXIpOyB9KTtcbiAgICB9KTtcbiAgfSxcblxuICB1cGRhdGU6IGZ1bmN0aW9uICgpIHtcblxuICB9LFxuXG4gIG9uSW5wdXREb3duOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5nYW1lLnN0YXRlLnN0YXJ0KCdNZW51Jyk7XG4gIH0sXG5cbiAgc2VsZWN0Q2hhcmFjdGVyOiBmdW5jdGlvbiAoY2hhcmFjdGVyKSB7XG4gICAgaWYgKHRoaXMuY2hhckZvY3VzICYmIHRoaXMuY2hhckZvY3VzICE9PSBjaGFyYWN0ZXIubG9jXG4gICAgICAgICYmIHRoaXMucGxheWVyTWFwW3RoaXMuY2hhckZvY3VzXS5jaGFyYWN0ZXIgIT09IGNoYXJhY3Rlcikge1xuICAgICAgdGhpcy5wbGF5ZXJNYXBbdGhpcy5jaGFyRm9jdXNdLmNoYXJhY3Rlci50b2dnbGVTZWxlY3QoKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5jaGFyRm9jdXMgJiYgdGhpcy5wbGF5ZXJNYXBbdGhpcy5jaGFyRm9jdXNdLmNoYXJhY3RlciA9PT0gY2hhcmFjdGVyKSB7XG4gICAgICB0aGlzLmNoYXJGb2N1cyA9IG51bGw7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuY2hhckZvY3VzID0gY2hhcmFjdGVyLmxvYztcbiAgICB9XG5cbiAgICBjaGFyYWN0ZXIudG9nZ2xlU2VsZWN0KCk7XG4gIH0sXG5cbiAgX2VuYWJsZU1vdmU6IGZ1bmN0aW9uIChsb2MpIHtcbiAgICBjb25zdCBjaGFyID0gdGhpcy5wbGF5ZXJNYXBbbG9jXS5jaGFyYWN0ZXI7XG4gICAgdGhpcy5wbGF5ZXJNYXAuZm9yRWFjaCgodmFsLCBpbmRleCkgPT4ge1xuICAgICAgdmFsLnRpbGUuaW5wdXRFbmFibGVkID0gdHJ1ZTtcbiAgICAgIGlmICh2YWwuY2hhcmFjdGVyKSB2YWwuY2hhcmFjdGVyLmlucHV0RW5hYmxlZCA9IGZhbHNlO1xuXG4gICAgICB2YWwudGlsZS5zZXRTdGF0dXMoJ3NlbGVjdGFibGUnKTtcbiAgICAgIHZhbC50aWxlLmV2ZW50cy5vbklucHV0RG93bi5hZGQoKCkgPT4geyB0aGlzLl9zZWxlY3RUaWxlKCdtb3ZlJywgbG9jLCBpbmRleCk7IH0pO1xuICAgIH0pO1xuICB9LFxuXG4gIF9zZWxlY3RUaWxlOiBmdW5jdGlvbiAoYWN0aW9uLCBvcmlnaW4sIHRhcmdldCkge1xuICAgIGNvbnN0IG9yaWdpblNsb3QgPSB0aGlzLnBsYXllck1hcFtvcmlnaW5dO1xuICAgIGNvbnN0IHRhcmdldFNsb3QgPSB0aGlzLnBsYXllck1hcFt0YXJnZXRdO1xuXG4gICAgaWYgKGFjdGlvbiA9PT0gJ21vdmUnKSB7XG4gICAgICBjb25zdCBjaGFyID0gb3JpZ2luU2xvdC5jaGFyYWN0ZXI7XG4gICAgICBjb25zdCBzd2FwQ2hhciA9IHRhcmdldFNsb3QuY2hhcmFjdGVyO1xuICAgICAgY2hhci5jaGFuZ2VMb2ModGFyZ2V0LCB0YXJnZXRTbG90LngsIHRhcmdldFNsb3QueSk7XG4gICAgICBpZiAoc3dhcENoYXIpIHN3YXBDaGFyLmNoYW5nZUxvYyhvcmlnaW4sIG9yaWdpblNsb3QueCwgb3JpZ2luU2xvdC55KTtcblxuICAgICAgdGhpcy5wbGF5ZXJNYXAuZm9yRWFjaCgodmFsKSA9PiB7XG4gICAgICAgIHZhbC50aWxlLnNldFN0YXR1cygnZGVmYXVsdCcpO1xuICAgICAgICBpZiAodmFsLmNoYXJhY3Rlcikge1xuICAgICAgICAgIHZhbC5jaGFyYWN0ZXIuaW5wdXRFbmFibGVkID0gdHJ1ZTtcbiAgICAgICAgICB2YWwuY2hhcmFjdGVyLm9uSG92ZXIoZmFsc2UpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gIH0sXG5cbiAgX2FjdGlvbkhhbmRsZXI6IGZ1bmN0aW9uIChhY3Rpb24sIHBhcmFtcykge1xuICAgIGlmIChhY3Rpb24gPT09ICdtb3ZlJykge1xuICAgICAgdGhpcy5fZW5hYmxlTW92ZShwYXJhbXMubG9jKTtcbiAgICB9XG4gIH0sXG59O1xuIiwidmFyIE1lbnUgPSBmdW5jdGlvbiAoKSB7XG4gIHRoaXMudGV4dCA9IG51bGw7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IE1lbnU7XG5cbk1lbnUucHJvdG90eXBlID0ge1xuXG4gIGNyZWF0ZTogZnVuY3Rpb24gKCkge1xuICAgIHZhciB4ID0gdGhpcy5nYW1lLndpZHRoIC8gMjtcbiAgICB2YXIgeSA9IHRoaXMuZ2FtZS5oZWlnaHQgLyAyO1xuXG4gICAgdmFyIHN0eWxlID0geyBmb250OiBcIjY1cHggQXJpYWxcIiwgZmlsbDogXCIjZmZmZmZmXCIsIGFsaWduOiBcImNlbnRlclwiIH07XG5cbiAgICB0aGlzLnRleHQgPSB0aGlzLmFkZC50ZXh0KHggLSAzMDAsIHkgLSAyMDAsIFwiUHJlc3MgdG8gU3RhcnRcIiwgc3R5bGUpO1xuXG4gICAgdGhpcy5pbnB1dC5vbkRvd24uYWRkKHRoaXMub25Eb3duLCB0aGlzKTtcbiAgfSxcblxuICB1cGRhdGU6IGZ1bmN0aW9uICgpIHtcbiAgfSxcblxuICBvbkRvd246IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmdhbWUuc3RhdGUuc3RhcnQocGxheWVyU3RhdGUuY3VycmVudExldmVsKTtcbiAgfVxufTtcbiIsInZhciBQcmVsb2FkZXIgPSBmdW5jdGlvbiAoZ2FtZSkge1xuICB0aGlzLmFzc2V0ID0gbnVsbDtcbiAgdGhpcy5yZWFkeSA9IGZhbHNlO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBQcmVsb2FkZXI7XG5cblByZWxvYWRlci5wcm90b3R5cGUgPSB7XG5cbiAgcHJlbG9hZDogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuYXNzZXQgPSB0aGlzLmFkZC5zcHJpdGUoMzIwLCAyNDAsICdwcmVsb2FkZXInKTtcbiAgICB0aGlzLmFzc2V0LmFuY2hvci5zZXRUbygwLjUsIDAuNSk7XG5cbiAgICB0aGlzLmxvYWQub25Mb2FkQ29tcGxldGUuYWRkT25jZSh0aGlzLm9uTG9hZENvbXBsZXRlLCB0aGlzKTtcbiAgICB0aGlzLmxvYWQuc2V0UHJlbG9hZFNwcml0ZSh0aGlzLmFzc2V0KTtcblxuICAgIC8qIGxvYWRpbmcgc3ByaXRlcyAqL1xuICAgIHRoaXMubG9hZC5pbWFnZSgnYWxseScsICdhc3NldHMvYWxseS5wbmcnKTtcbiAgICB0aGlzLmxvYWQuaW1hZ2UoJ2VuZW15JywgJ2Fzc2V0cy9lbmVteS5wbmcnKTtcblxuICAgIC8qIGxvYWRpbmcgdGV4dHVyZSBhdGxhc2VzICovXG4gICAgdGhpcy5sb2FkLmF0bGFzSlNPTkhhc2goJ3RpbGVzJywgJ2Fzc2V0cy90aWxlcy5wbmcnLCAnYXNzZXRzL3RpbGVzLmpzb24nKTtcbiAgfSxcblxuICBjcmVhdGU6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmFzc2V0LmNyb3BFbmFibGVkID0gZmFsc2U7XG4gIH0sXG5cbiAgdXBkYXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKCEhdGhpcy5yZWFkeSkge1xuICAgICAgdGhpcy5nYW1lLnN0YXRlLnN0YXJ0KCdHYW1lJywgdHJ1ZSwgZmFsc2UsIHsgdGVzdDogMSB9KTtcbiAgICB9XG4gIH0sXG5cbiAgb25Mb2FkQ29tcGxldGU6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLnJlYWR5ID0gdHJ1ZTtcbiAgfSxcbn07XG4iLCJ2YXIgU3BsYXNoID0gZnVuY3Rpb24gKCkge1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBTcGxhc2g7XG5cblNwbGFzaC5wcm90b3R5cGUgPSB7XG4gIGNyZWF0ZTogZnVuY3Rpb24gKCkge1xuICB9XG59OyIsInZhciBVdGlscyA9IHtcbiAgICBjb250YWluc09iamVjdDogZnVuY3Rpb24ob2JqLCBsaXN0KSB7XG4gICAgICAgIHZhciBpO1xuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYgKGxpc3RbaV0gPT09IG9iaikge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbn07XG5cbm1vZHVsZS5leHBvcnRzID0gVXRpbHM7Il19
