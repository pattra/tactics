(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({"/Users/pattra/Documents/dev/GitHub/tactics/src/js/entities/charBattleDetail.js":[function(require,module,exports){
'use strict';

const CharBattleDetail = function (game, x, y, properties, handler) {
  this.vitals = game.add.group();
  this.vitals.visible = false;
  this.text = {};
  this.handler = handler;

  const style = { font: '24px Arial', fill: '#ff0044' };

  /* full detail panel */
  this.text.name = game.add.text(0, game.world.centerY, properties.name, style, this.vitals);
  this.text.hp = game.add.text(0, game.world.centerY + 50, properties.maxHP + '/' + properties.maxHP, style, this.vitals);

  /* actions */
  this.text.move = game.add.text(0, game.world.centerY + 100, 'Move Character', style, this.vitals);
  this.text.move.inputEnabled = true;
  this.text.move.events.onInputDown.add(() => { this.handler('move'); });

  this.text.attack = game.add.text(0, game.world.centerY + 150, 'Attack', style, this.vitals);
  this.text.attack.inputEnabled = true;
  this.text.attack.events.onInputDown.add(() => { this.handler('attack', { loc: properties.loc, ability: 'standard' }); });

  this.toggleDisplay = () => {
    this.vitals.visible = !this.vitals.visible;
  };

  this.updateHP = (current, max) => {
    this.text.hp.setText(current + '/' + max);
  };
};

CharBattleDetail.prototype.constructor = CharBattleDetail;

/**
 * Automatically called by World.update
 */
CharBattleDetail.prototype.update = function () {
};

module.exports = CharBattleDetail;

},{}],"/Users/pattra/Documents/dev/GitHub/tactics/src/js/entities/charBattlePreview.js":[function(require,module,exports){
'use strict';

const CharBattlePreview = function (game, x, y, properties) {
  this.vitals = game.add.group();
  this.vitals.visible = false;
  this.text = {};

  const style = { font: '24px Arial', fill: '#ff0044' };

  /* preview panel */
  this.text.name = game.add.text(game.world.centerX, game.world.centerY, properties.name, style, this.vitals);
  this.text.hp = game.add.text(game.world.centerX, game.world.centerY + 50, properties.maxHP + '/' + properties.maxHP, style, this.vitals);

  this.toggleDisplay = (cursorOn) => {
    this.vitals.visible = cursorOn;
  };

  this.updateHP = (current, max) => {
    this.text.hp.setText(current + '/' + max);
  };
};

CharBattlePreview.prototype.constructor = CharBattlePreview;

/**
 * Automatically called by World.update
 */
CharBattlePreview.prototype.update = function () {
};

module.exports = CharBattlePreview;

},{}],"/Users/pattra/Documents/dev/GitHub/tactics/src/js/entities/character.js":[function(require,module,exports){
'use strict';

const Preview = require('../entities/charBattlePreview');
const Detail = require('../entities/charBattleDetail');

const Character = function (game, x, y, properties) {
  /* PROPERTIES */
  this.loc = properties.loc;

  this.handler = properties.actionHandler;
  this.UIHandler = (action) => {
    this.handler(action, this.loc);
  };

  this.preview = new Preview(game, x, y, properties);
  this.detail = new Detail(game, x, y, properties, this.UIHandler);
  this.name = properties.name;
  this.maxHP = properties.maxHP;
  this.currentHP = properties.maxHP;
  this.team = properties.team;

  /* FUNCTIONS */
  this.onHover = (cursorOn) => {
    this.preview.toggleDisplay(cursorOn);
  };

  this.toggleSelect = () => {
    this.detail.toggleDisplay();
  };

  this.changeHP = (amt) => {
    this.currentHP = this.currentHP + amt;
    this.preview.updateHP(this.currentHP, this.maxHP);
    this.detail.updateHP(this.currentHP, this.maxHP);
  };

  this.changeLoc = (loc, x, y) => {
    this.loc = loc;
    this.sprite.x = x;
    this.sprite.y = y;
  };

  this.onClick = () => {
    this.handler('select', this.loc);
    this.detail.toggleDisplay();
  };

  this.sprite = game.add.sprite(x, y, properties.sprite);

  this.sprite.inputEnabled = true;
  this.sprite.events.onInputOver.add(() => { this.onHover(true); });
  this.sprite.events.onInputOut.add(() => { this.onHover(false); });
  this.sprite.events.onInputDown.add(this.onClick);
};

// Character.prototype = Object.create(Phaser.Sprite.prototype);
Character.prototype.constructor = Character;

/**
 * Automatically called by World.update
 */
Character.prototype.update = function () {
};

module.exports = Character;

},{"../entities/charBattleDetail":"/Users/pattra/Documents/dev/GitHub/tactics/src/js/entities/charBattleDetail.js","../entities/charBattlePreview":"/Users/pattra/Documents/dev/GitHub/tactics/src/js/entities/charBattlePreview.js"}],"/Users/pattra/Documents/dev/GitHub/tactics/src/js/entities/tile.js":[function(require,module,exports){
'use strict';

const Tile = function (game, x, y) {
  this.status = 'default';
  this.defaultState = 'grass';

  this.setStatus = (frameName, status) => {
    this.frameName = frameName === 'default' ? this.defaultState : frameName;
    this.status = status ? status : frameName;
  };

  Phaser.Sprite.call(this, game, x, y, 'tiles', 'grass');

  game.add.existing(this);
};

Tile.prototype = Object.create(Phaser.Sprite.prototype);
Tile.prototype.constructor = Tile;

Tile.prototype.update = function () {
};

module.exports = Tile;

},{}],"/Users/pattra/Documents/dev/GitHub/tactics/src/js/main.js":[function(require,module,exports){
'use strict';

var game = new Phaser.Game(800, 600, Phaser.AUTO, 'tactics-game');

window.Utils = require('./utils');
window.playerState = {
  currentLevel: 'Game',
};

game.state.add('Boot', require('./states/boot'));
game.state.add('Splash', require('./states/splash'));
game.state.add('Preloader', require('./states/preloader'));
game.state.add('Menu', require('./states/menu'));
game.state.add('Game', require('./states/game'));

game.state.start('Boot');

},{"./states/boot":"/Users/pattra/Documents/dev/GitHub/tactics/src/js/states/boot.js","./states/game":"/Users/pattra/Documents/dev/GitHub/tactics/src/js/states/game.js","./states/menu":"/Users/pattra/Documents/dev/GitHub/tactics/src/js/states/menu.js","./states/preloader":"/Users/pattra/Documents/dev/GitHub/tactics/src/js/states/preloader.js","./states/splash":"/Users/pattra/Documents/dev/GitHub/tactics/src/js/states/splash.js","./utils":"/Users/pattra/Documents/dev/GitHub/tactics/src/js/utils.js"}],"/Users/pattra/Documents/dev/GitHub/tactics/src/js/states/boot.js":[function(require,module,exports){
var Boot = function () {};

module.exports = Boot;

Boot.prototype = {

  preload: function () {
    this.load.image('preloader', 'assets/preloader.gif');
  },

  create: function () {
    this.game.input.maxPointers = 1;

    if (this.game.device.desktop) {
      this.game.stage.scale.pageAlignHorizontally = true;
    } else {
      this.game.scale.scaleMode = Phaser.ScaleManager.SHOW_ALL;
      this.game.scale.minWidth =  480;
      this.game.scale.minHeight = 260;
      this.game.scale.maxWidth = 640;
      this.game.scale.maxHeight = 480;
      this.game.scale.forceLandscape = true;
      this.game.scale.pageAlignHorizontally = true;
      this.game.scale.setScreenSize(true);
    }

    this.game.state.start('Preloader');
  }
};

},{}],"/Users/pattra/Documents/dev/GitHub/tactics/src/js/states/game.js":[function(require,module,exports){
'use strict';

const Character = require('../entities/character');
const Tile = require('../entities/tile');

const MAP_SIZE = 3;
const MAP_TOTAL_TILES = 9;

const PLAYER_FILE = {
  party: [
    {
      name: 'Sobel',
      maxHP: 10,
      isPlayer: true,
      defaultLoc: 3,
      loc: 3,
    },
    {
      name: 'Fenris',
      maxHP: 15,
      defaultLoc: 5,
      loc: 5,
    },
    {
      name: 'Corrin',
      maxHP: 15,
      defaultLoc: 2,
      loc: 2,
    },
  ],
};

const LEVEL_MAP = {
  enemies: [
    {
      name: 'baddie 1',
      maxHP: 3,
      defaultLoc: 0,
      loc: 0,
    },
    {
      name: 'baddie 2',
      maxHP: 5,
      defaultLoc: 6,
      loc: 6,
    },
  ],
};

const Game = function () {
  this.charFocus = null;
  this.playerMap = [];
  this.enemyMap = [];
};

module.exports = Game;

Game.prototype = {

  init: function (param) {
    // console.log(param);
  },

  create: function () {
    const mapOffset = 400;
    let i;
    let j;

    /* INIT TILES */
    for (i = 0; i < MAP_SIZE; i++) {
      for (j = 0; j < MAP_SIZE; j++) {
        let playerTile;
        let enemyTile;

        // player tiles
        playerTile = new Tile(this.game, j * 100, i * 100);
        this.playerMap.push({
          tile: playerTile,
          x: j * 100,
          y: i * 100,
        });

        // enemy tiles
        enemyTile = new Tile(this.game, j * 100 + mapOffset, i * 100);
        this.enemyMap.push({
          tile: enemyTile,
          x: j * 100 + mapOffset,
          y: i * 100,
        });
      }
    }

    /* INIT CHARACTERS */
    PLAYER_FILE.party.forEach((char, index) => {
      // TODO: error checking for location overlaps
      let slot = this.playerMap[char.defaultLoc];
      slot.character = new Character(this.game, slot.x, slot.y, Object.assign(char, {
        team: 'ally',
        sprite: 'ally',
        actionHandler: this._actionHandler.bind(this),
      }));
    });

    /* INIT BADDIES */
    // LEVEL_MAP.enemies.forEach((char, index) => {
    //   let slot = this.enemyMap[char.defaultLoc];
    //   slot.character = new Character(this.game, slot.x, slot.y, Object.assign(char, {
    //     team: 'enemy',
    //     sprite: 'enemy',
    //     actionHandler: this._actionHandler.bind(this),
    //   }));
    //
    //   slot.character.inputEnabled = true;
    //   slot.character.events.onInputOver.add(() => { slot.character.onHover(true); });
    //   slot.character.events.onInputOut.add(() => { slot.character.onHover(false); });
    //   slot.character.events.onInputDown.add(() => { this.selectCharacter(slot.character); });
    // });
  },

  update: function () {

  },

  _selectCharacter: function (character) {
    if (this.charFocus && this.charFocus !== character.loc
        && this.playerMap[this.charFocus].character) {
      this.playerMap[this.charFocus].character.toggleSelect();
    }

    if (this.charFocus && this.playerMap[this.charFocus].character === character) {
      this.charFocus = null;
    } else {
      this.charFocus = character.loc;
    }
  },

  _enableMove: function (loc) {
    this.playerMap.forEach((val, index) => {
      val.tile.inputEnabled = true;
      if (val.character) {
        val.character.sprite.events.onInputDown.removeAll();
        val.character.sprite.events.onInputDown.add(() => { this._moveCharacter(loc, index); });
      }

      val.tile.setStatus('selectable');
      val.tile.events.onInputDown.add(() => { this._moveCharacter(loc, index); });
    });
  },

  _moveCharacter: function (origin, target) {
    const originSlot = this.playerMap[origin];
    const targetSlot = this.playerMap[target];
    const char = originSlot.character;
    const swapChar = targetSlot.character;

    if (!!char && !!char.name) char.changeLoc(target, targetSlot.x, targetSlot.y);
    this.playerMap[target].character = char;
    this.playerMap[origin].character = null;
    if (!!swapChar && !!swapChar.name) {
      swapChar.changeLoc(origin, originSlot.x, originSlot.y);
      this.playerMap[origin].character = swapChar;
    }

    this.playerMap.forEach((val) => {
      val.tile.setStatus('default');
      val.tile.events.onInputDown.removeAll();
      if (val.character) {
        val.character.sprite.events.onInputDown.removeAll();
        val.character.sprite.events.onInputDown.add(val.character.onClick);
        val.character.onHover(false);
      }
    });

    this.charFocus = target;
  },

  _actionHandler: function (action, loc) {
    if (action === 'select') {
      this._selectCharacter(this.playerMap[loc].character);
    } else if (action === 'move') {
      this._enableMove(loc);
    }
  },
};

},{"../entities/character":"/Users/pattra/Documents/dev/GitHub/tactics/src/js/entities/character.js","../entities/tile":"/Users/pattra/Documents/dev/GitHub/tactics/src/js/entities/tile.js"}],"/Users/pattra/Documents/dev/GitHub/tactics/src/js/states/menu.js":[function(require,module,exports){
var Menu = function () {
  this.text = null;
};

module.exports = Menu;

Menu.prototype = {

  create: function () {
    var x = this.game.width / 2;
    var y = this.game.height / 2;

    var style = { font: "65px Arial", fill: "#ffffff", align: "center" };

    this.text = this.add.text(x - 300, y - 200, "Press to Start", style);

    this.input.onDown.add(this.onDown, this);
  },

  update: function () {
  },

  onDown: function () {
    this.game.state.start(playerState.currentLevel);
  }
};

},{}],"/Users/pattra/Documents/dev/GitHub/tactics/src/js/states/preloader.js":[function(require,module,exports){
var Preloader = function (game) {
  this.asset = null;
  this.ready = false;
};

module.exports = Preloader;

Preloader.prototype = {

  preload: function () {
    this.asset = this.add.sprite(320, 240, 'preloader');
    this.asset.anchor.setTo(0.5, 0.5);

    this.load.onLoadComplete.addOnce(this.onLoadComplete, this);
    this.load.setPreloadSprite(this.asset);

    /* loading sprites */
    this.load.image('ally', 'assets/ally.png');
    this.load.image('enemy', 'assets/enemy.png');

    /* loading texture atlases */
    this.load.atlasJSONHash('tiles', 'assets/tiles.png', 'assets/tiles.json');
  },

  create: function () {
    this.asset.cropEnabled = false;
  },

  update: function () {
    if (!!this.ready) {
      this.game.state.start('Game', true, false, { test: 1 });
    }
  },

  onLoadComplete: function () {
    this.ready = true;
  },
};

},{}],"/Users/pattra/Documents/dev/GitHub/tactics/src/js/states/splash.js":[function(require,module,exports){
var Splash = function () {
};

module.exports = Splash;

Splash.prototype = {
  create: function () {
  }
};
},{}],"/Users/pattra/Documents/dev/GitHub/tactics/src/js/utils.js":[function(require,module,exports){
var Utils = {
    containsObject: function(obj, list) {
        var i;
        for (i = 0; i < list.length; i++) {
            if (list[i] === obj) {
                return true;
            }
        }

        return false;
    }
};

module.exports = Utils;
},{}]},{},["/Users/pattra/Documents/dev/GitHub/tactics/src/js/main.js"])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvanMvZW50aXRpZXMvY2hhckJhdHRsZURldGFpbC5qcyIsInNyYy9qcy9lbnRpdGllcy9jaGFyQmF0dGxlUHJldmlldy5qcyIsInNyYy9qcy9lbnRpdGllcy9jaGFyYWN0ZXIuanMiLCJzcmMvanMvZW50aXRpZXMvdGlsZS5qcyIsInNyYy9qcy9tYWluLmpzIiwic3JjL2pzL3N0YXRlcy9ib290LmpzIiwic3JjL2pzL3N0YXRlcy9nYW1lLmpzIiwic3JjL2pzL3N0YXRlcy9tZW51LmpzIiwic3JjL2pzL3N0YXRlcy9wcmVsb2FkZXIuanMiLCJzcmMvanMvc3RhdGVzL3NwbGFzaC5qcyIsInNyYy9qcy91dGlscy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQ0FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN6Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMvQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2pFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDaEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM3QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN4TEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzFCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNSQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIid1c2Ugc3RyaWN0JztcblxuY29uc3QgQ2hhckJhdHRsZURldGFpbCA9IGZ1bmN0aW9uIChnYW1lLCB4LCB5LCBwcm9wZXJ0aWVzLCBoYW5kbGVyKSB7XG4gIHRoaXMudml0YWxzID0gZ2FtZS5hZGQuZ3JvdXAoKTtcbiAgdGhpcy52aXRhbHMudmlzaWJsZSA9IGZhbHNlO1xuICB0aGlzLnRleHQgPSB7fTtcbiAgdGhpcy5oYW5kbGVyID0gaGFuZGxlcjtcblxuICBjb25zdCBzdHlsZSA9IHsgZm9udDogJzI0cHggQXJpYWwnLCBmaWxsOiAnI2ZmMDA0NCcgfTtcblxuICAvKiBmdWxsIGRldGFpbCBwYW5lbCAqL1xuICB0aGlzLnRleHQubmFtZSA9IGdhbWUuYWRkLnRleHQoMCwgZ2FtZS53b3JsZC5jZW50ZXJZLCBwcm9wZXJ0aWVzLm5hbWUsIHN0eWxlLCB0aGlzLnZpdGFscyk7XG4gIHRoaXMudGV4dC5ocCA9IGdhbWUuYWRkLnRleHQoMCwgZ2FtZS53b3JsZC5jZW50ZXJZICsgNTAsIHByb3BlcnRpZXMubWF4SFAgKyAnLycgKyBwcm9wZXJ0aWVzLm1heEhQLCBzdHlsZSwgdGhpcy52aXRhbHMpO1xuXG4gIC8qIGFjdGlvbnMgKi9cbiAgdGhpcy50ZXh0Lm1vdmUgPSBnYW1lLmFkZC50ZXh0KDAsIGdhbWUud29ybGQuY2VudGVyWSArIDEwMCwgJ01vdmUgQ2hhcmFjdGVyJywgc3R5bGUsIHRoaXMudml0YWxzKTtcbiAgdGhpcy50ZXh0Lm1vdmUuaW5wdXRFbmFibGVkID0gdHJ1ZTtcbiAgdGhpcy50ZXh0Lm1vdmUuZXZlbnRzLm9uSW5wdXREb3duLmFkZCgoKSA9PiB7IHRoaXMuaGFuZGxlcignbW92ZScpOyB9KTtcblxuICB0aGlzLnRleHQuYXR0YWNrID0gZ2FtZS5hZGQudGV4dCgwLCBnYW1lLndvcmxkLmNlbnRlclkgKyAxNTAsICdBdHRhY2snLCBzdHlsZSwgdGhpcy52aXRhbHMpO1xuICB0aGlzLnRleHQuYXR0YWNrLmlucHV0RW5hYmxlZCA9IHRydWU7XG4gIHRoaXMudGV4dC5hdHRhY2suZXZlbnRzLm9uSW5wdXREb3duLmFkZCgoKSA9PiB7IHRoaXMuaGFuZGxlcignYXR0YWNrJywgeyBsb2M6IHByb3BlcnRpZXMubG9jLCBhYmlsaXR5OiAnc3RhbmRhcmQnIH0pOyB9KTtcblxuICB0aGlzLnRvZ2dsZURpc3BsYXkgPSAoKSA9PiB7XG4gICAgdGhpcy52aXRhbHMudmlzaWJsZSA9ICF0aGlzLnZpdGFscy52aXNpYmxlO1xuICB9O1xuXG4gIHRoaXMudXBkYXRlSFAgPSAoY3VycmVudCwgbWF4KSA9PiB7XG4gICAgdGhpcy50ZXh0LmhwLnNldFRleHQoY3VycmVudCArICcvJyArIG1heCk7XG4gIH07XG59O1xuXG5DaGFyQmF0dGxlRGV0YWlsLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IENoYXJCYXR0bGVEZXRhaWw7XG5cbi8qKlxuICogQXV0b21hdGljYWxseSBjYWxsZWQgYnkgV29ybGQudXBkYXRlXG4gKi9cbkNoYXJCYXR0bGVEZXRhaWwucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gQ2hhckJhdHRsZURldGFpbDtcbiIsIid1c2Ugc3RyaWN0JztcblxuY29uc3QgQ2hhckJhdHRsZVByZXZpZXcgPSBmdW5jdGlvbiAoZ2FtZSwgeCwgeSwgcHJvcGVydGllcykge1xuICB0aGlzLnZpdGFscyA9IGdhbWUuYWRkLmdyb3VwKCk7XG4gIHRoaXMudml0YWxzLnZpc2libGUgPSBmYWxzZTtcbiAgdGhpcy50ZXh0ID0ge307XG5cbiAgY29uc3Qgc3R5bGUgPSB7IGZvbnQ6ICcyNHB4IEFyaWFsJywgZmlsbDogJyNmZjAwNDQnIH07XG5cbiAgLyogcHJldmlldyBwYW5lbCAqL1xuICB0aGlzLnRleHQubmFtZSA9IGdhbWUuYWRkLnRleHQoZ2FtZS53b3JsZC5jZW50ZXJYLCBnYW1lLndvcmxkLmNlbnRlclksIHByb3BlcnRpZXMubmFtZSwgc3R5bGUsIHRoaXMudml0YWxzKTtcbiAgdGhpcy50ZXh0LmhwID0gZ2FtZS5hZGQudGV4dChnYW1lLndvcmxkLmNlbnRlclgsIGdhbWUud29ybGQuY2VudGVyWSArIDUwLCBwcm9wZXJ0aWVzLm1heEhQICsgJy8nICsgcHJvcGVydGllcy5tYXhIUCwgc3R5bGUsIHRoaXMudml0YWxzKTtcblxuICB0aGlzLnRvZ2dsZURpc3BsYXkgPSAoY3Vyc29yT24pID0+IHtcbiAgICB0aGlzLnZpdGFscy52aXNpYmxlID0gY3Vyc29yT247XG4gIH07XG5cbiAgdGhpcy51cGRhdGVIUCA9IChjdXJyZW50LCBtYXgpID0+IHtcbiAgICB0aGlzLnRleHQuaHAuc2V0VGV4dChjdXJyZW50ICsgJy8nICsgbWF4KTtcbiAgfTtcbn07XG5cbkNoYXJCYXR0bGVQcmV2aWV3LnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IENoYXJCYXR0bGVQcmV2aWV3O1xuXG4vKipcbiAqIEF1dG9tYXRpY2FsbHkgY2FsbGVkIGJ5IFdvcmxkLnVwZGF0ZVxuICovXG5DaGFyQmF0dGxlUHJldmlldy5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24gKCkge1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBDaGFyQmF0dGxlUHJldmlldztcbiIsIid1c2Ugc3RyaWN0JztcblxuY29uc3QgUHJldmlldyA9IHJlcXVpcmUoJy4uL2VudGl0aWVzL2NoYXJCYXR0bGVQcmV2aWV3Jyk7XG5jb25zdCBEZXRhaWwgPSByZXF1aXJlKCcuLi9lbnRpdGllcy9jaGFyQmF0dGxlRGV0YWlsJyk7XG5cbmNvbnN0IENoYXJhY3RlciA9IGZ1bmN0aW9uIChnYW1lLCB4LCB5LCBwcm9wZXJ0aWVzKSB7XG4gIC8qIFBST1BFUlRJRVMgKi9cbiAgdGhpcy5sb2MgPSBwcm9wZXJ0aWVzLmxvYztcblxuICB0aGlzLmhhbmRsZXIgPSBwcm9wZXJ0aWVzLmFjdGlvbkhhbmRsZXI7XG4gIHRoaXMuVUlIYW5kbGVyID0gKGFjdGlvbikgPT4ge1xuICAgIHRoaXMuaGFuZGxlcihhY3Rpb24sIHRoaXMubG9jKTtcbiAgfTtcblxuICB0aGlzLnByZXZpZXcgPSBuZXcgUHJldmlldyhnYW1lLCB4LCB5LCBwcm9wZXJ0aWVzKTtcbiAgdGhpcy5kZXRhaWwgPSBuZXcgRGV0YWlsKGdhbWUsIHgsIHksIHByb3BlcnRpZXMsIHRoaXMuVUlIYW5kbGVyKTtcbiAgdGhpcy5uYW1lID0gcHJvcGVydGllcy5uYW1lO1xuICB0aGlzLm1heEhQID0gcHJvcGVydGllcy5tYXhIUDtcbiAgdGhpcy5jdXJyZW50SFAgPSBwcm9wZXJ0aWVzLm1heEhQO1xuICB0aGlzLnRlYW0gPSBwcm9wZXJ0aWVzLnRlYW07XG5cbiAgLyogRlVOQ1RJT05TICovXG4gIHRoaXMub25Ib3ZlciA9IChjdXJzb3JPbikgPT4ge1xuICAgIHRoaXMucHJldmlldy50b2dnbGVEaXNwbGF5KGN1cnNvck9uKTtcbiAgfTtcblxuICB0aGlzLnRvZ2dsZVNlbGVjdCA9ICgpID0+IHtcbiAgICB0aGlzLmRldGFpbC50b2dnbGVEaXNwbGF5KCk7XG4gIH07XG5cbiAgdGhpcy5jaGFuZ2VIUCA9IChhbXQpID0+IHtcbiAgICB0aGlzLmN1cnJlbnRIUCA9IHRoaXMuY3VycmVudEhQICsgYW10O1xuICAgIHRoaXMucHJldmlldy51cGRhdGVIUCh0aGlzLmN1cnJlbnRIUCwgdGhpcy5tYXhIUCk7XG4gICAgdGhpcy5kZXRhaWwudXBkYXRlSFAodGhpcy5jdXJyZW50SFAsIHRoaXMubWF4SFApO1xuICB9O1xuXG4gIHRoaXMuY2hhbmdlTG9jID0gKGxvYywgeCwgeSkgPT4ge1xuICAgIHRoaXMubG9jID0gbG9jO1xuICAgIHRoaXMuc3ByaXRlLnggPSB4O1xuICAgIHRoaXMuc3ByaXRlLnkgPSB5O1xuICB9O1xuXG4gIHRoaXMub25DbGljayA9ICgpID0+IHtcbiAgICB0aGlzLmhhbmRsZXIoJ3NlbGVjdCcsIHRoaXMubG9jKTtcbiAgICB0aGlzLmRldGFpbC50b2dnbGVEaXNwbGF5KCk7XG4gIH07XG5cbiAgdGhpcy5zcHJpdGUgPSBnYW1lLmFkZC5zcHJpdGUoeCwgeSwgcHJvcGVydGllcy5zcHJpdGUpO1xuXG4gIHRoaXMuc3ByaXRlLmlucHV0RW5hYmxlZCA9IHRydWU7XG4gIHRoaXMuc3ByaXRlLmV2ZW50cy5vbklucHV0T3Zlci5hZGQoKCkgPT4geyB0aGlzLm9uSG92ZXIodHJ1ZSk7IH0pO1xuICB0aGlzLnNwcml0ZS5ldmVudHMub25JbnB1dE91dC5hZGQoKCkgPT4geyB0aGlzLm9uSG92ZXIoZmFsc2UpOyB9KTtcbiAgdGhpcy5zcHJpdGUuZXZlbnRzLm9uSW5wdXREb3duLmFkZCh0aGlzLm9uQ2xpY2spO1xufTtcblxuLy8gQ2hhcmFjdGVyLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoUGhhc2VyLlNwcml0ZS5wcm90b3R5cGUpO1xuQ2hhcmFjdGVyLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IENoYXJhY3RlcjtcblxuLyoqXG4gKiBBdXRvbWF0aWNhbGx5IGNhbGxlZCBieSBXb3JsZC51cGRhdGVcbiAqL1xuQ2hhcmFjdGVyLnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbiAoKSB7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IENoYXJhY3RlcjtcbiIsIid1c2Ugc3RyaWN0JztcblxuY29uc3QgVGlsZSA9IGZ1bmN0aW9uIChnYW1lLCB4LCB5KSB7XG4gIHRoaXMuc3RhdHVzID0gJ2RlZmF1bHQnO1xuICB0aGlzLmRlZmF1bHRTdGF0ZSA9ICdncmFzcyc7XG5cbiAgdGhpcy5zZXRTdGF0dXMgPSAoZnJhbWVOYW1lLCBzdGF0dXMpID0+IHtcbiAgICB0aGlzLmZyYW1lTmFtZSA9IGZyYW1lTmFtZSA9PT0gJ2RlZmF1bHQnID8gdGhpcy5kZWZhdWx0U3RhdGUgOiBmcmFtZU5hbWU7XG4gICAgdGhpcy5zdGF0dXMgPSBzdGF0dXMgPyBzdGF0dXMgOiBmcmFtZU5hbWU7XG4gIH07XG5cbiAgUGhhc2VyLlNwcml0ZS5jYWxsKHRoaXMsIGdhbWUsIHgsIHksICd0aWxlcycsICdncmFzcycpO1xuXG4gIGdhbWUuYWRkLmV4aXN0aW5nKHRoaXMpO1xufTtcblxuVGlsZS5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKFBoYXNlci5TcHJpdGUucHJvdG90eXBlKTtcblRpbGUucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gVGlsZTtcblxuVGlsZS5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24gKCkge1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBUaWxlO1xuIiwiJ3VzZSBzdHJpY3QnO1xuXG52YXIgZ2FtZSA9IG5ldyBQaGFzZXIuR2FtZSg4MDAsIDYwMCwgUGhhc2VyLkFVVE8sICd0YWN0aWNzLWdhbWUnKTtcblxud2luZG93LlV0aWxzID0gcmVxdWlyZSgnLi91dGlscycpO1xud2luZG93LnBsYXllclN0YXRlID0ge1xuICBjdXJyZW50TGV2ZWw6ICdHYW1lJyxcbn07XG5cbmdhbWUuc3RhdGUuYWRkKCdCb290JywgcmVxdWlyZSgnLi9zdGF0ZXMvYm9vdCcpKTtcbmdhbWUuc3RhdGUuYWRkKCdTcGxhc2gnLCByZXF1aXJlKCcuL3N0YXRlcy9zcGxhc2gnKSk7XG5nYW1lLnN0YXRlLmFkZCgnUHJlbG9hZGVyJywgcmVxdWlyZSgnLi9zdGF0ZXMvcHJlbG9hZGVyJykpO1xuZ2FtZS5zdGF0ZS5hZGQoJ01lbnUnLCByZXF1aXJlKCcuL3N0YXRlcy9tZW51JykpO1xuZ2FtZS5zdGF0ZS5hZGQoJ0dhbWUnLCByZXF1aXJlKCcuL3N0YXRlcy9nYW1lJykpO1xuXG5nYW1lLnN0YXRlLnN0YXJ0KCdCb290Jyk7XG4iLCJ2YXIgQm9vdCA9IGZ1bmN0aW9uICgpIHt9O1xuXG5tb2R1bGUuZXhwb3J0cyA9IEJvb3Q7XG5cbkJvb3QucHJvdG90eXBlID0ge1xuXG4gIHByZWxvYWQ6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmxvYWQuaW1hZ2UoJ3ByZWxvYWRlcicsICdhc3NldHMvcHJlbG9hZGVyLmdpZicpO1xuICB9LFxuXG4gIGNyZWF0ZTogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuZ2FtZS5pbnB1dC5tYXhQb2ludGVycyA9IDE7XG5cbiAgICBpZiAodGhpcy5nYW1lLmRldmljZS5kZXNrdG9wKSB7XG4gICAgICB0aGlzLmdhbWUuc3RhZ2Uuc2NhbGUucGFnZUFsaWduSG9yaXpvbnRhbGx5ID0gdHJ1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5nYW1lLnNjYWxlLnNjYWxlTW9kZSA9IFBoYXNlci5TY2FsZU1hbmFnZXIuU0hPV19BTEw7XG4gICAgICB0aGlzLmdhbWUuc2NhbGUubWluV2lkdGggPSAgNDgwO1xuICAgICAgdGhpcy5nYW1lLnNjYWxlLm1pbkhlaWdodCA9IDI2MDtcbiAgICAgIHRoaXMuZ2FtZS5zY2FsZS5tYXhXaWR0aCA9IDY0MDtcbiAgICAgIHRoaXMuZ2FtZS5zY2FsZS5tYXhIZWlnaHQgPSA0ODA7XG4gICAgICB0aGlzLmdhbWUuc2NhbGUuZm9yY2VMYW5kc2NhcGUgPSB0cnVlO1xuICAgICAgdGhpcy5nYW1lLnNjYWxlLnBhZ2VBbGlnbkhvcml6b250YWxseSA9IHRydWU7XG4gICAgICB0aGlzLmdhbWUuc2NhbGUuc2V0U2NyZWVuU2l6ZSh0cnVlKTtcbiAgICB9XG5cbiAgICB0aGlzLmdhbWUuc3RhdGUuc3RhcnQoJ1ByZWxvYWRlcicpO1xuICB9XG59O1xuIiwiJ3VzZSBzdHJpY3QnO1xuXG5jb25zdCBDaGFyYWN0ZXIgPSByZXF1aXJlKCcuLi9lbnRpdGllcy9jaGFyYWN0ZXInKTtcbmNvbnN0IFRpbGUgPSByZXF1aXJlKCcuLi9lbnRpdGllcy90aWxlJyk7XG5cbmNvbnN0IE1BUF9TSVpFID0gMztcbmNvbnN0IE1BUF9UT1RBTF9USUxFUyA9IDk7XG5cbmNvbnN0IFBMQVlFUl9GSUxFID0ge1xuICBwYXJ0eTogW1xuICAgIHtcbiAgICAgIG5hbWU6ICdTb2JlbCcsXG4gICAgICBtYXhIUDogMTAsXG4gICAgICBpc1BsYXllcjogdHJ1ZSxcbiAgICAgIGRlZmF1bHRMb2M6IDMsXG4gICAgICBsb2M6IDMsXG4gICAgfSxcbiAgICB7XG4gICAgICBuYW1lOiAnRmVucmlzJyxcbiAgICAgIG1heEhQOiAxNSxcbiAgICAgIGRlZmF1bHRMb2M6IDUsXG4gICAgICBsb2M6IDUsXG4gICAgfSxcbiAgICB7XG4gICAgICBuYW1lOiAnQ29ycmluJyxcbiAgICAgIG1heEhQOiAxNSxcbiAgICAgIGRlZmF1bHRMb2M6IDIsXG4gICAgICBsb2M6IDIsXG4gICAgfSxcbiAgXSxcbn07XG5cbmNvbnN0IExFVkVMX01BUCA9IHtcbiAgZW5lbWllczogW1xuICAgIHtcbiAgICAgIG5hbWU6ICdiYWRkaWUgMScsXG4gICAgICBtYXhIUDogMyxcbiAgICAgIGRlZmF1bHRMb2M6IDAsXG4gICAgICBsb2M6IDAsXG4gICAgfSxcbiAgICB7XG4gICAgICBuYW1lOiAnYmFkZGllIDInLFxuICAgICAgbWF4SFA6IDUsXG4gICAgICBkZWZhdWx0TG9jOiA2LFxuICAgICAgbG9jOiA2LFxuICAgIH0sXG4gIF0sXG59O1xuXG5jb25zdCBHYW1lID0gZnVuY3Rpb24gKCkge1xuICB0aGlzLmNoYXJGb2N1cyA9IG51bGw7XG4gIHRoaXMucGxheWVyTWFwID0gW107XG4gIHRoaXMuZW5lbXlNYXAgPSBbXTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gR2FtZTtcblxuR2FtZS5wcm90b3R5cGUgPSB7XG5cbiAgaW5pdDogZnVuY3Rpb24gKHBhcmFtKSB7XG4gICAgLy8gY29uc29sZS5sb2cocGFyYW0pO1xuICB9LFxuXG4gIGNyZWF0ZTogZnVuY3Rpb24gKCkge1xuICAgIGNvbnN0IG1hcE9mZnNldCA9IDQwMDtcbiAgICBsZXQgaTtcbiAgICBsZXQgajtcblxuICAgIC8qIElOSVQgVElMRVMgKi9cbiAgICBmb3IgKGkgPSAwOyBpIDwgTUFQX1NJWkU7IGkrKykge1xuICAgICAgZm9yIChqID0gMDsgaiA8IE1BUF9TSVpFOyBqKyspIHtcbiAgICAgICAgbGV0IHBsYXllclRpbGU7XG4gICAgICAgIGxldCBlbmVteVRpbGU7XG5cbiAgICAgICAgLy8gcGxheWVyIHRpbGVzXG4gICAgICAgIHBsYXllclRpbGUgPSBuZXcgVGlsZSh0aGlzLmdhbWUsIGogKiAxMDAsIGkgKiAxMDApO1xuICAgICAgICB0aGlzLnBsYXllck1hcC5wdXNoKHtcbiAgICAgICAgICB0aWxlOiBwbGF5ZXJUaWxlLFxuICAgICAgICAgIHg6IGogKiAxMDAsXG4gICAgICAgICAgeTogaSAqIDEwMCxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gZW5lbXkgdGlsZXNcbiAgICAgICAgZW5lbXlUaWxlID0gbmV3IFRpbGUodGhpcy5nYW1lLCBqICogMTAwICsgbWFwT2Zmc2V0LCBpICogMTAwKTtcbiAgICAgICAgdGhpcy5lbmVteU1hcC5wdXNoKHtcbiAgICAgICAgICB0aWxlOiBlbmVteVRpbGUsXG4gICAgICAgICAgeDogaiAqIDEwMCArIG1hcE9mZnNldCxcbiAgICAgICAgICB5OiBpICogMTAwLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKiBJTklUIENIQVJBQ1RFUlMgKi9cbiAgICBQTEFZRVJfRklMRS5wYXJ0eS5mb3JFYWNoKChjaGFyLCBpbmRleCkgPT4ge1xuICAgICAgLy8gVE9ETzogZXJyb3IgY2hlY2tpbmcgZm9yIGxvY2F0aW9uIG92ZXJsYXBzXG4gICAgICBsZXQgc2xvdCA9IHRoaXMucGxheWVyTWFwW2NoYXIuZGVmYXVsdExvY107XG4gICAgICBzbG90LmNoYXJhY3RlciA9IG5ldyBDaGFyYWN0ZXIodGhpcy5nYW1lLCBzbG90LngsIHNsb3QueSwgT2JqZWN0LmFzc2lnbihjaGFyLCB7XG4gICAgICAgIHRlYW06ICdhbGx5JyxcbiAgICAgICAgc3ByaXRlOiAnYWxseScsXG4gICAgICAgIGFjdGlvbkhhbmRsZXI6IHRoaXMuX2FjdGlvbkhhbmRsZXIuYmluZCh0aGlzKSxcbiAgICAgIH0pKTtcbiAgICB9KTtcblxuICAgIC8qIElOSVQgQkFERElFUyAqL1xuICAgIC8vIExFVkVMX01BUC5lbmVtaWVzLmZvckVhY2goKGNoYXIsIGluZGV4KSA9PiB7XG4gICAgLy8gICBsZXQgc2xvdCA9IHRoaXMuZW5lbXlNYXBbY2hhci5kZWZhdWx0TG9jXTtcbiAgICAvLyAgIHNsb3QuY2hhcmFjdGVyID0gbmV3IENoYXJhY3Rlcih0aGlzLmdhbWUsIHNsb3QueCwgc2xvdC55LCBPYmplY3QuYXNzaWduKGNoYXIsIHtcbiAgICAvLyAgICAgdGVhbTogJ2VuZW15JyxcbiAgICAvLyAgICAgc3ByaXRlOiAnZW5lbXknLFxuICAgIC8vICAgICBhY3Rpb25IYW5kbGVyOiB0aGlzLl9hY3Rpb25IYW5kbGVyLmJpbmQodGhpcyksXG4gICAgLy8gICB9KSk7XG4gICAgLy9cbiAgICAvLyAgIHNsb3QuY2hhcmFjdGVyLmlucHV0RW5hYmxlZCA9IHRydWU7XG4gICAgLy8gICBzbG90LmNoYXJhY3Rlci5ldmVudHMub25JbnB1dE92ZXIuYWRkKCgpID0+IHsgc2xvdC5jaGFyYWN0ZXIub25Ib3Zlcih0cnVlKTsgfSk7XG4gICAgLy8gICBzbG90LmNoYXJhY3Rlci5ldmVudHMub25JbnB1dE91dC5hZGQoKCkgPT4geyBzbG90LmNoYXJhY3Rlci5vbkhvdmVyKGZhbHNlKTsgfSk7XG4gICAgLy8gICBzbG90LmNoYXJhY3Rlci5ldmVudHMub25JbnB1dERvd24uYWRkKCgpID0+IHsgdGhpcy5zZWxlY3RDaGFyYWN0ZXIoc2xvdC5jaGFyYWN0ZXIpOyB9KTtcbiAgICAvLyB9KTtcbiAgfSxcblxuICB1cGRhdGU6IGZ1bmN0aW9uICgpIHtcblxuICB9LFxuXG4gIF9zZWxlY3RDaGFyYWN0ZXI6IGZ1bmN0aW9uIChjaGFyYWN0ZXIpIHtcbiAgICBpZiAodGhpcy5jaGFyRm9jdXMgJiYgdGhpcy5jaGFyRm9jdXMgIT09IGNoYXJhY3Rlci5sb2NcbiAgICAgICAgJiYgdGhpcy5wbGF5ZXJNYXBbdGhpcy5jaGFyRm9jdXNdLmNoYXJhY3Rlcikge1xuICAgICAgdGhpcy5wbGF5ZXJNYXBbdGhpcy5jaGFyRm9jdXNdLmNoYXJhY3Rlci50b2dnbGVTZWxlY3QoKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5jaGFyRm9jdXMgJiYgdGhpcy5wbGF5ZXJNYXBbdGhpcy5jaGFyRm9jdXNdLmNoYXJhY3RlciA9PT0gY2hhcmFjdGVyKSB7XG4gICAgICB0aGlzLmNoYXJGb2N1cyA9IG51bGw7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuY2hhckZvY3VzID0gY2hhcmFjdGVyLmxvYztcbiAgICB9XG4gIH0sXG5cbiAgX2VuYWJsZU1vdmU6IGZ1bmN0aW9uIChsb2MpIHtcbiAgICB0aGlzLnBsYXllck1hcC5mb3JFYWNoKCh2YWwsIGluZGV4KSA9PiB7XG4gICAgICB2YWwudGlsZS5pbnB1dEVuYWJsZWQgPSB0cnVlO1xuICAgICAgaWYgKHZhbC5jaGFyYWN0ZXIpIHtcbiAgICAgICAgdmFsLmNoYXJhY3Rlci5zcHJpdGUuZXZlbnRzLm9uSW5wdXREb3duLnJlbW92ZUFsbCgpO1xuICAgICAgICB2YWwuY2hhcmFjdGVyLnNwcml0ZS5ldmVudHMub25JbnB1dERvd24uYWRkKCgpID0+IHsgdGhpcy5fbW92ZUNoYXJhY3Rlcihsb2MsIGluZGV4KTsgfSk7XG4gICAgICB9XG5cbiAgICAgIHZhbC50aWxlLnNldFN0YXR1cygnc2VsZWN0YWJsZScpO1xuICAgICAgdmFsLnRpbGUuZXZlbnRzLm9uSW5wdXREb3duLmFkZCgoKSA9PiB7IHRoaXMuX21vdmVDaGFyYWN0ZXIobG9jLCBpbmRleCk7IH0pO1xuICAgIH0pO1xuICB9LFxuXG4gIF9tb3ZlQ2hhcmFjdGVyOiBmdW5jdGlvbiAob3JpZ2luLCB0YXJnZXQpIHtcbiAgICBjb25zdCBvcmlnaW5TbG90ID0gdGhpcy5wbGF5ZXJNYXBbb3JpZ2luXTtcbiAgICBjb25zdCB0YXJnZXRTbG90ID0gdGhpcy5wbGF5ZXJNYXBbdGFyZ2V0XTtcbiAgICBjb25zdCBjaGFyID0gb3JpZ2luU2xvdC5jaGFyYWN0ZXI7XG4gICAgY29uc3Qgc3dhcENoYXIgPSB0YXJnZXRTbG90LmNoYXJhY3RlcjtcblxuICAgIGlmICghIWNoYXIgJiYgISFjaGFyLm5hbWUpIGNoYXIuY2hhbmdlTG9jKHRhcmdldCwgdGFyZ2V0U2xvdC54LCB0YXJnZXRTbG90LnkpO1xuICAgIHRoaXMucGxheWVyTWFwW3RhcmdldF0uY2hhcmFjdGVyID0gY2hhcjtcbiAgICB0aGlzLnBsYXllck1hcFtvcmlnaW5dLmNoYXJhY3RlciA9IG51bGw7XG4gICAgaWYgKCEhc3dhcENoYXIgJiYgISFzd2FwQ2hhci5uYW1lKSB7XG4gICAgICBzd2FwQ2hhci5jaGFuZ2VMb2Mob3JpZ2luLCBvcmlnaW5TbG90LngsIG9yaWdpblNsb3QueSk7XG4gICAgICB0aGlzLnBsYXllck1hcFtvcmlnaW5dLmNoYXJhY3RlciA9IHN3YXBDaGFyO1xuICAgIH1cblxuICAgIHRoaXMucGxheWVyTWFwLmZvckVhY2goKHZhbCkgPT4ge1xuICAgICAgdmFsLnRpbGUuc2V0U3RhdHVzKCdkZWZhdWx0Jyk7XG4gICAgICB2YWwudGlsZS5ldmVudHMub25JbnB1dERvd24ucmVtb3ZlQWxsKCk7XG4gICAgICBpZiAodmFsLmNoYXJhY3Rlcikge1xuICAgICAgICB2YWwuY2hhcmFjdGVyLnNwcml0ZS5ldmVudHMub25JbnB1dERvd24ucmVtb3ZlQWxsKCk7XG4gICAgICAgIHZhbC5jaGFyYWN0ZXIuc3ByaXRlLmV2ZW50cy5vbklucHV0RG93bi5hZGQodmFsLmNoYXJhY3Rlci5vbkNsaWNrKTtcbiAgICAgICAgdmFsLmNoYXJhY3Rlci5vbkhvdmVyKGZhbHNlKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHRoaXMuY2hhckZvY3VzID0gdGFyZ2V0O1xuICB9LFxuXG4gIF9hY3Rpb25IYW5kbGVyOiBmdW5jdGlvbiAoYWN0aW9uLCBsb2MpIHtcbiAgICBpZiAoYWN0aW9uID09PSAnc2VsZWN0Jykge1xuICAgICAgdGhpcy5fc2VsZWN0Q2hhcmFjdGVyKHRoaXMucGxheWVyTWFwW2xvY10uY2hhcmFjdGVyKTtcbiAgICB9IGVsc2UgaWYgKGFjdGlvbiA9PT0gJ21vdmUnKSB7XG4gICAgICB0aGlzLl9lbmFibGVNb3ZlKGxvYyk7XG4gICAgfVxuICB9LFxufTtcbiIsInZhciBNZW51ID0gZnVuY3Rpb24gKCkge1xuICB0aGlzLnRleHQgPSBudWxsO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBNZW51O1xuXG5NZW51LnByb3RvdHlwZSA9IHtcblxuICBjcmVhdGU6IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgeCA9IHRoaXMuZ2FtZS53aWR0aCAvIDI7XG4gICAgdmFyIHkgPSB0aGlzLmdhbWUuaGVpZ2h0IC8gMjtcblxuICAgIHZhciBzdHlsZSA9IHsgZm9udDogXCI2NXB4IEFyaWFsXCIsIGZpbGw6IFwiI2ZmZmZmZlwiLCBhbGlnbjogXCJjZW50ZXJcIiB9O1xuXG4gICAgdGhpcy50ZXh0ID0gdGhpcy5hZGQudGV4dCh4IC0gMzAwLCB5IC0gMjAwLCBcIlByZXNzIHRvIFN0YXJ0XCIsIHN0eWxlKTtcblxuICAgIHRoaXMuaW5wdXQub25Eb3duLmFkZCh0aGlzLm9uRG93biwgdGhpcyk7XG4gIH0sXG5cbiAgdXBkYXRlOiBmdW5jdGlvbiAoKSB7XG4gIH0sXG5cbiAgb25Eb3duOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5nYW1lLnN0YXRlLnN0YXJ0KHBsYXllclN0YXRlLmN1cnJlbnRMZXZlbCk7XG4gIH1cbn07XG4iLCJ2YXIgUHJlbG9hZGVyID0gZnVuY3Rpb24gKGdhbWUpIHtcbiAgdGhpcy5hc3NldCA9IG51bGw7XG4gIHRoaXMucmVhZHkgPSBmYWxzZTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gUHJlbG9hZGVyO1xuXG5QcmVsb2FkZXIucHJvdG90eXBlID0ge1xuXG4gIHByZWxvYWQ6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmFzc2V0ID0gdGhpcy5hZGQuc3ByaXRlKDMyMCwgMjQwLCAncHJlbG9hZGVyJyk7XG4gICAgdGhpcy5hc3NldC5hbmNob3Iuc2V0VG8oMC41LCAwLjUpO1xuXG4gICAgdGhpcy5sb2FkLm9uTG9hZENvbXBsZXRlLmFkZE9uY2UodGhpcy5vbkxvYWRDb21wbGV0ZSwgdGhpcyk7XG4gICAgdGhpcy5sb2FkLnNldFByZWxvYWRTcHJpdGUodGhpcy5hc3NldCk7XG5cbiAgICAvKiBsb2FkaW5nIHNwcml0ZXMgKi9cbiAgICB0aGlzLmxvYWQuaW1hZ2UoJ2FsbHknLCAnYXNzZXRzL2FsbHkucG5nJyk7XG4gICAgdGhpcy5sb2FkLmltYWdlKCdlbmVteScsICdhc3NldHMvZW5lbXkucG5nJyk7XG5cbiAgICAvKiBsb2FkaW5nIHRleHR1cmUgYXRsYXNlcyAqL1xuICAgIHRoaXMubG9hZC5hdGxhc0pTT05IYXNoKCd0aWxlcycsICdhc3NldHMvdGlsZXMucG5nJywgJ2Fzc2V0cy90aWxlcy5qc29uJyk7XG4gIH0sXG5cbiAgY3JlYXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5hc3NldC5jcm9wRW5hYmxlZCA9IGZhbHNlO1xuICB9LFxuXG4gIHVwZGF0ZTogZnVuY3Rpb24gKCkge1xuICAgIGlmICghIXRoaXMucmVhZHkpIHtcbiAgICAgIHRoaXMuZ2FtZS5zdGF0ZS5zdGFydCgnR2FtZScsIHRydWUsIGZhbHNlLCB7IHRlc3Q6IDEgfSk7XG4gICAgfVxuICB9LFxuXG4gIG9uTG9hZENvbXBsZXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5yZWFkeSA9IHRydWU7XG4gIH0sXG59O1xuIiwidmFyIFNwbGFzaCA9IGZ1bmN0aW9uICgpIHtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gU3BsYXNoO1xuXG5TcGxhc2gucHJvdG90eXBlID0ge1xuICBjcmVhdGU6IGZ1bmN0aW9uICgpIHtcbiAgfVxufTsiLCJ2YXIgVXRpbHMgPSB7XG4gICAgY29udGFpbnNPYmplY3Q6IGZ1bmN0aW9uKG9iaiwgbGlzdCkge1xuICAgICAgICB2YXIgaTtcbiAgICAgICAgZm9yIChpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmIChsaXN0W2ldID09PSBvYmopIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFV0aWxzOyJdfQ==
