(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({"/Users/pattra/Documents/dev/GitHub/tactics/src/js/entities/charBattleDetail.js":[function(require,module,exports){
'use strict';

const CharBattleDetail = function (game, x, y, properties, handler) {
  this.vitals = game.add.group();
  this.vitals.visible = false;
  this.text = {};
  this.handler = handler;

  const style = { font: '24px Arial', fill: '#ff0044' };

  /* full detail panel */
  this.text.name = game.add.text(0, game.world.centerY, properties.name, style, this.vitals);
  this.text.hp = game.add.text(0, game.world.centerY + 50, properties.maxHP + '/' + properties.maxHP, style, this.vitals);

  /* actions */
  this.text.move = game.add.text(0, game.world.centerY + 100, 'Move Character', style, this.vitals);
  this.text.move.inputEnabled = true;
  this.text.move.events.onInputDown.add(() => { this.handler('move'); });

  this.text.attack = game.add.text(0, game.world.centerY + 150, 'Attack', style, this.vitals);
  this.text.attack.inputEnabled = true;
  this.text.attack.events.onInputDown.add(() => { this.handler('attack'); });

  this.toggleDisplay = () => {
    this.vitals.visible = !this.vitals.visible;
  };

  this.updateHP = (current, max) => {
    this.text.hp.setText(current + '/' + max);
  };
};

CharBattleDetail.prototype.constructor = CharBattleDetail;

/**
 * Automatically called by World.update
 */
CharBattleDetail.prototype.update = function () {
};

module.exports = CharBattleDetail;

},{}],"/Users/pattra/Documents/dev/GitHub/tactics/src/js/entities/charBattlePreview.js":[function(require,module,exports){
'use strict';

const CharBattlePreview = function (game, x, y, properties) {
  this.vitals = game.add.group();
  this.vitals.visible = false;
  this.text = {};

  const style = { font: '24px Arial', fill: '#ff0044' };

  /* preview panel */
  this.text.name = game.add.text(game.world.centerX, game.world.centerY, properties.name, style, this.vitals);
  this.text.hp = game.add.text(game.world.centerX, game.world.centerY + 50, properties.maxHP + '/' + properties.maxHP, style, this.vitals);

  this.toggleDisplay = (cursorOn) => {
    this.vitals.visible = cursorOn;
  };

  this.updateHP = (current, max) => {
    this.text.hp.setText(current + '/' + max);
  };
};

CharBattlePreview.prototype.constructor = CharBattlePreview;

/**
 * Automatically called by World.update
 */
CharBattlePreview.prototype.update = function () {
};

module.exports = CharBattlePreview;

},{}],"/Users/pattra/Documents/dev/GitHub/tactics/src/js/entities/enemyCharacter.js":[function(require,module,exports){
'use strict';

const Preview = require('../entities/charBattlePreview');

const EnemyCharacter = function (game, x, y, properties) {
  /* PROPERTIES */
  this.loc = properties.loc;
  this.handler = properties.actionHandler;

  this.preview = new Preview(game, x, y, properties);
  this.name = properties.name;
  this.maxHP = properties.maxHP;
  this.currentHP = properties.maxHP;

  /* FUNCTIONS */
  this.onHover = (cursorOn) => {
    this.preview.toggleDisplay(cursorOn);
  };

  // this.toggleSelect = () => {
  //   this.detail.toggleDisplay();
  // };

  this.changeHP = (amt) => {
    this.currentHP = this.currentHP + amt;

    if (this.currentHP < 1) {
      this.sprite.kill();
      this.handler('kill', this.loc);
    } else {
      this.preview.updateHP(this.currentHP, this.maxHP);
    }
  };

  this.changeLoc = (loc, x, y) => {
    this.loc = loc;
    this.sprite.x = x;
    this.sprite.y = y;
  };

  this.onClick = () => {
    this.handler('select', this.loc);
  };

  this.sprite = game.add.sprite(x, y, properties.sprite);

  this.sprite.inputEnabled = true;
  this.sprite.events.onInputOver.add(() => { this.onHover(true); });
  this.sprite.events.onInputOut.add(() => { this.onHover(false); });
  this.sprite.events.onInputDown.add(this.onClick);
};

// Character.prototype = Object.create(Phaser.Sprite.prototype);
EnemyCharacter.prototype.constructor = EnemyCharacter;

/**
 * Automatically called by World.update
 */
EnemyCharacter.prototype.update = function () {
};

module.exports = EnemyCharacter;

},{"../entities/charBattlePreview":"/Users/pattra/Documents/dev/GitHub/tactics/src/js/entities/charBattlePreview.js"}],"/Users/pattra/Documents/dev/GitHub/tactics/src/js/entities/playerCharacter.js":[function(require,module,exports){
'use strict';

const Preview = require('../entities/charBattlePreview');
const Detail = require('../entities/charBattleDetail');

const PlayerCharacter = function (game, x, y, properties) {
  /* PROPERTIES */
  this.loc = properties.loc;
  this.range = properties.range;

  this.handler = properties.actionHandler;
  this.UIHandler = (action, params) => {
    if (action === 'attack') {
      params = { range: this.range };
    }

    if (action) {
      this.handler(action, this.loc, params);
    }
  };

  this.preview = new Preview(game, x, y, properties);
  this.detail = new Detail(game, x, y, properties, this.UIHandler);
  this.name = properties.name;
  this.maxHP = properties.maxHP;
  this.currentHP = properties.maxHP;
  this.attack = properties.attack;

  /* FUNCTIONS */
  this.onHover = (cursorOn) => {
    this.preview.toggleDisplay(cursorOn);
  };

  this.toggleSelect = () => {
    this.detail.toggleDisplay();
  };

  this.changeHP = (amt) => {
    this.currentHP = this.currentHP + amt;

    if (this.currentHP < 1) {
      this.sprite.kill();
      this.handler('kill', this.loc);
    } else {
      this.preview.updateHP(this.currentHP, this.maxHP);
      this.detail.updateHP(this.currentHP, this.maxHP);
    }
  };

  this.changeLoc = (loc, x, y) => {
    this.loc = loc;
    this.sprite.x = x;
    this.sprite.y = y;
  };

  this.onClick = () => {
    this.handler('select', this.loc);
    this.detail.toggleDisplay();
  };

  this.sprite = game.add.sprite(x, y, properties.sprite);

  this.sprite.inputEnabled = true;
  this.sprite.events.onInputOver.add(() => { this.onHover(true); });
  this.sprite.events.onInputOut.add(() => { this.onHover(false); });
  this.sprite.events.onInputDown.add(this.onClick);
};

// Character.prototype = Object.create(Phaser.Sprite.prototype);
PlayerCharacter.prototype.constructor = PlayerCharacter;

/**
 * Automatically called by World.update
 */
PlayerCharacter.prototype.update = function () {
};

module.exports = PlayerCharacter;

},{"../entities/charBattleDetail":"/Users/pattra/Documents/dev/GitHub/tactics/src/js/entities/charBattleDetail.js","../entities/charBattlePreview":"/Users/pattra/Documents/dev/GitHub/tactics/src/js/entities/charBattlePreview.js"}],"/Users/pattra/Documents/dev/GitHub/tactics/src/js/entities/tile.js":[function(require,module,exports){
'use strict';

const Tile = function (game, x, y) {
  this.status = 'default';
  this.defaultState = 'grass';

  this.setStatus = (frameName, status) => {
    this.frameName = frameName === 'default' ? this.defaultState : frameName;
    this.status = status ? status : frameName; // doesn't currently do anything
  };

  Phaser.Sprite.call(this, game, x, y, 'tiles', 'grass');

  game.add.existing(this);
};

Tile.prototype = Object.create(Phaser.Sprite.prototype);
Tile.prototype.constructor = Tile;

Tile.prototype.update = function () {
};

module.exports = Tile;

},{}],"/Users/pattra/Documents/dev/GitHub/tactics/src/js/main.js":[function(require,module,exports){
'use strict';

var game = new Phaser.Game(800, 600, Phaser.AUTO, 'tactics-game');

window.Utils = require('./utils');
window.playerState = {
  currentLevel: 'Game',
};

game.state.add('Boot', require('./states/boot'));
game.state.add('Splash', require('./states/splash'));
game.state.add('Preloader', require('./states/preloader'));
game.state.add('Menu', require('./states/menu'));
game.state.add('Game', require('./states/game'));

game.state.start('Boot');

},{"./states/boot":"/Users/pattra/Documents/dev/GitHub/tactics/src/js/states/boot.js","./states/game":"/Users/pattra/Documents/dev/GitHub/tactics/src/js/states/game.js","./states/menu":"/Users/pattra/Documents/dev/GitHub/tactics/src/js/states/menu.js","./states/preloader":"/Users/pattra/Documents/dev/GitHub/tactics/src/js/states/preloader.js","./states/splash":"/Users/pattra/Documents/dev/GitHub/tactics/src/js/states/splash.js","./utils":"/Users/pattra/Documents/dev/GitHub/tactics/src/js/utils.js"}],"/Users/pattra/Documents/dev/GitHub/tactics/src/js/states/boot.js":[function(require,module,exports){
var Boot = function () {};

module.exports = Boot;

Boot.prototype = {

  preload: function () {
    this.load.image('preloader', 'assets/preloader.gif');
  },

  create: function () {
    this.game.input.maxPointers = 1;

    if (this.game.device.desktop) {
      this.game.stage.scale.pageAlignHorizontally = true;
    } else {
      this.game.scale.scaleMode = Phaser.ScaleManager.SHOW_ALL;
      this.game.scale.minWidth =  480;
      this.game.scale.minHeight = 260;
      this.game.scale.maxWidth = 640;
      this.game.scale.maxHeight = 480;
      this.game.scale.forceLandscape = true;
      this.game.scale.pageAlignHorizontally = true;
      this.game.scale.setScreenSize(true);
    }

    this.game.state.start('Preloader');
  }
};

},{}],"/Users/pattra/Documents/dev/GitHub/tactics/src/js/states/game.js":[function(require,module,exports){
'use strict';

const PlayerCharacter = require('../entities/playerCharacter');
const EnemyCharacter = require('../entities/enemyCharacter');
const Tile = require('../entities/tile');

const MAP_SIZE = 3;
const MAP_TOTAL_TILES = 9;

const PLAYER_FILE = {
  party: [
    {
      name: 'Sobel',
      maxHP: 10,
      isPlayer: true,
      loc: 3,
      attack: 1,
      range: 'pierce',
    },
    {
      name: 'Fenris',
      maxHP: 15,
      loc: 5,
      attack: 3,
      range: 'swing',
    },
    {
      name: 'Corrin',
      maxHP: 15,
      loc: 2,
      attack: 2,
      range: 'reach',
    },
  ],
};

const LEVEL_MAP = {
  enemies: [
    {
      name: 'baddie 1',
      maxHP: 3,
      loc: 0,
    },
    {
      name: 'baddie 2',
      maxHP: 5,
      loc: 7,
    },
    {
      name: 'baddie 3',
      maxHP: 3,
      loc: 1,
    },
    {
      name: 'baddie 4',
      maxHP: 3,
      loc: 2,
    },
    {
      name: 'baddie 5',
      maxHP: 3,
      loc: 3,
    },
  ],
};

const Game = function () {
  this.charFocus = null;
  this.playerMap = [];
  this.enemyMap = [];

  this.getEnemyTargets = {
    melee: function (origin) {
      /* [ ][ ][ ]
         [x][ ][ ]
         [ ][ ][ ] */
      const targetable = [];
      const map = this.enemyMap;
      let index;

      for (let i = 0; i < MAP_SIZE; i++) {
        for (let j = 0; j < MAP_SIZE; j++) {
          index = i * MAP_SIZE + j;
          if (map[index].character) {
            targetable.push(index);
            this._setUpTarget(map, origin, index, []);
            break;
          }
        }
      }

      return targetable;
    },

    ranged: function (origin) {
      /* [ ][ ][ ]
         [ ][x][ ] (any)
         [ ][ ][ ] */
      const map = this.enemyMap;

      for (let i = 0; i < MAP_TOTAL_TILES; i++) {
        if (map[i].character) {
          targetable.push(i);
          this._setUpTarget(map, origin, i, []);
        }
      }
    },

    reach: function (origin) {
      /* [ ][ ][ ]
         [x][x][ ]
         [ ][ ][ ] */
      const map = this.enemyMap;
      let index;
      let reachIndex;

      for (let i = 0; i < MAP_SIZE; i++) {
        for (let j = 0; j < MAP_SIZE; j++) {
          index = i * MAP_SIZE + j;
          if (map[index].character) {
            reachIndex = index + 1;
            if (reachIndex % MAP_SIZE !== 0) {
              this._setUpTarget(map, origin, index, [reachIndex]);
            } else {
              this._setUpTarget(map, origin, index, []);
            }

            targetable.push(index);
            break;
          }
        }
      }
    },

    pierce: function (origin) {
      /* [ ][ ][ ]
         [x][x][x]
         [ ][ ][ ] */
      const map = this.enemyMap;
      let index;
      let neighbors = [];

      for (let i = 0; i < MAP_SIZE; i++) {
        for (let j = 0; j < MAP_SIZE; j++) {
          index = i * MAP_SIZE + j;
          if (map[index].character) {
            neighbors = [];
            for (let k = i * MAP_SIZE; k < (i + 1) * MAP_SIZE; k++) {
              if (k !== index) neighbors.push(k);
            }

            this._setUpTarget(map, origin, index, neighbors);
          }
        }
      }
    },

    spread: function () {
      /* [ ][x][ ]
         [x][x][x]
         [ ][x][ ] */
      const map = this.enemyMap;
      let index;
      let neighbors = [];
    },

    swing: function (origin) {
      /* [O][ ][x]
         [x][x][O]
         [ ][O][x] */
      const map = this.enemyMap;
      let index;
      let neighbors = [];
      let topIndex;
      let botIndex;

      for (let i = 0; i < MAP_SIZE; i++) {
        for (let j = 0; j < MAP_SIZE; j++) {
          neighbors = [];
          index = i * MAP_SIZE + j;

          if (map[index].character) {
            topIndex = index - MAP_SIZE;
            botIndex = index + MAP_SIZE;

            if (topIndex > -1) neighbors.push(index - MAP_SIZE);
            if (botIndex < MAP_TOTAL_TILES) neighbors.push(index + MAP_SIZE);

            this._setUpTarget(map, origin, index, neighbors);
            break;
          }
        }
      }
    },

    impact: function (origin) {
      /* [x][ ][ ]
         [x][ ][ ]
         [x][ ][ ] */
      const map = this.enemyMap;
      let index;
      let neighbors = [];

      for (let i = 0; i < MAP_SIZE; i++) {
        for (let j = 0; j < MAP_SIZE; j++) {
          index = i * MAP_SIZE + j;
          if (map[index].character) {
            neighbors = [];

            for (let k = j; k < (j + 1 + (MAP_SIZE * (MAP_SIZE - 1))); k += 3) {
              if (k !== index) neighbors.push(k);
            }

            this._setUpTarget(map, origin, index, neighbors);
            break;
          }
        }
      }
    },

    all: function () {
      /* [x][x][x]
         [x][x][x]
         [x][x][x] */
    },
  };

  this.getPlayerTargets = {
    melee: function (map) {
      /* [ ][ ][ ]
         [x][ ][ ]
         [ ][ ][ ] */
      let index;
      let targetable = [];

      for (let i = MAP_SIZE - 1; i >= 0; i--) {
        for (let j = MAP_SIZE - 1; j >= 0; j--) {
          index = i * MAP_SIZE + j;
          if (map[index].character) {
            targetable.push(index);
            break;
          }
        }
      }

      return targetable;
    },
  };
};

module.exports = Game;

Game.prototype = {

  init: function (param) {
    // console.log(param);
  },

  create: function () {
    const mapOffset = 400;
    let i;
    let j;

    /* INIT TILES */
    for (i = 0; i < MAP_SIZE; i++) {
      for (j = 0; j < MAP_SIZE; j++) {
        let playerTile;
        let enemyTile;

        // player tiles
        playerTile = new Tile(this.game, j * 100, i * 100);
        this.playerMap.push({
          tile: playerTile,
          x: j * 100,
          y: i * 100,
        });

        // enemy tiles
        enemyTile = new Tile(this.game, j * 100 + mapOffset, i * 100);
        this.enemyMap.push({
          tile: enemyTile,
          x: j * 100 + mapOffset,
          y: i * 100,
        });
      }
    }

    /* INIT CHARACTERS */
    PLAYER_FILE.party.forEach((char, index) => {
      // TODO: error checking for location overlaps
      let slot = this.playerMap[char.loc];
      slot.character = new PlayerCharacter(this.game, slot.x, slot.y, Object.assign(char, {
        team: 'ally',
        sprite: 'ally',
        actionHandler: this._playerActionHandler.bind(this),
      }));
    });

    /* INIT BADDIES */
    LEVEL_MAP.enemies.forEach((char, index) => {
      let slot = this.enemyMap[char.loc];
      slot.character = new EnemyCharacter(this.game, slot.x, slot.y, Object.assign(char, {
        team: 'enemy',
        sprite: 'enemy',
        actionHandler: this._enemyActionHandler.bind(this),
      }));
    });
  },

  update: function () {
  },

  _selectCharacter: function (character) {
    if (this.charFocus && this.charFocus !== character.loc
        && this.playerMap[this.charFocus].character) {
      this.playerMap[this.charFocus].character.toggleSelect();
    }

    if (this.charFocus && this.playerMap[this.charFocus].character === character) {
      this.charFocus = null;
    } else {
      this.charFocus = character.loc;
    }
  },

  _enableTargeting: function (origin, range) {
    this.getEnemyTargets[range].bind(this)(origin);
  },

  _enableMove: function (loc) {
    this.playerMap.forEach((val, index) => {
      val.tile.inputEnabled = true;
      if (val.character) {
        val.character.sprite.events.onInputDown.removeAll();
        val.character.sprite.events.onInputDown.add(() => { this._moveCharacter(loc, index); });
      }

      val.tile.setStatus('select');
      val.tile.events.onInputDown.add(() => { this._moveCharacter(loc, index); });
    });
  },

  _moveCharacter: function (origin, target) {
    const originSlot = this.playerMap[origin];
    const targetSlot = this.playerMap[target];
    const char = originSlot.character;
    const swapChar = targetSlot.character;

    if (!!char && !!char.name) char.changeLoc(target, targetSlot.x, targetSlot.y);
    this.playerMap[target].character = char;
    this.playerMap[origin].character = null;
    if (!!swapChar && !!swapChar.name) {
      swapChar.changeLoc(origin, originSlot.x, originSlot.y);
      this.playerMap[origin].character = swapChar;
    }

    this.playerMap.forEach((val) => {
      val.tile.setStatus('default');
      val.tile.events.onInputDown.removeAll();
      if (val.character) {
        val.character.sprite.events.onInputDown.removeAll();
        val.character.sprite.events.onInputDown.add(val.character.onClick);
        val.character.onHover(false);
      }
    });

    this.charFocus = target;
  },

  _targetCharacter: function (origin, target) {
    console.log('origin', origin, 'map', this.playerMap);
    let clearMap = this.enemyMap;
    let actor = this.playerMap[origin].character;
    let recip = this.enemyMap[target].character;

    recip.changeHP(-1 * actor.attack);
    this._clearMap(clearMap);
  },

  _clearMap: function (map) {
    map.forEach((val, index) => {
      if (val.character) val.character.sprite.events.onInputDown.removeAll();
      val.tile.events.onInputDown.removeAll();
      val.tile.setStatus('default');
    });
  },

  _setUpTarget: function (map, origin, loc, neighbors) {
    let val = map[loc];

    val.character.sprite.events.onInputDown.removeAll();
    val.character.sprite.events.onInputDown.add(() => { this._targetCharacter(origin, loc); });

    val.tile.inputEnabled = true;
    val.tile.events.onInputDown.add(() => { this._targetCharacter(origin, loc); });
    this._setTileHover(map, val.tile, val.character.sprite, 'attack', neighbors);
  },

  _setTileHover: function (map, tile, char, frameName, neighbors) {
    tile.events.onInputOver.add(() => {
      tile.setStatus(frameName);
      neighbors.forEach((n) => {
        map[n].tile.setStatus('affect');
      });
    });

    tile.events.onInputOut.add(() => {
      tile.setStatus('default');
      neighbors.forEach((n) => {
        map[n].tile.setStatus('default');
      });
    });

    char.events.onInputOver.add(() => {
      tile.setStatus(frameName);
      neighbors.forEach((n) => {
        map[n].tile.setStatus('affect');
      });
    });

    char.events.onInputOut.add(() => {
      tile.setStatus('default');
      neighbors.forEach((n) => {
        map[n].tile.setStatus('default');
      });
    });
  },

  _playerActionHandler: function (action, loc, params) {
    if (action === 'select') {
      this._selectCharacter(this.playerMap[loc].character);
    } else if (action === 'move') {
      this._enableMove(loc);
    } else if (action === 'attack') {
      console.log(action, loc, params);
      this._enableTargeting(loc, params.range);
    }
  },

  _enemyActionHandler: function (action, loc) {
    if (action === 'kill') {
      this._killCharacter(this.enemyMap, loc);
    }
  },

  _killCharacter: function (map, loc) {
    map[loc].character = null;
  },
};

},{"../entities/enemyCharacter":"/Users/pattra/Documents/dev/GitHub/tactics/src/js/entities/enemyCharacter.js","../entities/playerCharacter":"/Users/pattra/Documents/dev/GitHub/tactics/src/js/entities/playerCharacter.js","../entities/tile":"/Users/pattra/Documents/dev/GitHub/tactics/src/js/entities/tile.js"}],"/Users/pattra/Documents/dev/GitHub/tactics/src/js/states/menu.js":[function(require,module,exports){
var Menu = function () {
  this.text = null;
};

module.exports = Menu;

Menu.prototype = {

  create: function () {
    var x = this.game.width / 2;
    var y = this.game.height / 2;

    var style = { font: "65px Arial", fill: "#ffffff", align: "center" };

    this.text = this.add.text(x - 300, y - 200, "Press to Start", style);

    this.input.onDown.add(this.onDown, this);
  },

  update: function () {
  },

  onDown: function () {
    this.game.state.start(playerState.currentLevel);
  }
};

},{}],"/Users/pattra/Documents/dev/GitHub/tactics/src/js/states/preloader.js":[function(require,module,exports){
var Preloader = function (game) {
  this.asset = null;
  this.ready = false;
};

module.exports = Preloader;

Preloader.prototype = {

  preload: function () {
    this.asset = this.add.sprite(320, 240, 'preloader');
    this.asset.anchor.setTo(0.5, 0.5);

    this.load.onLoadComplete.addOnce(this.onLoadComplete, this);
    this.load.setPreloadSprite(this.asset);

    /* loading sprites */
    this.load.image('ally', 'assets/ally.png');
    this.load.image('enemy', 'assets/enemy.png');

    /* loading texture atlases */
    this.load.atlasJSONHash('tiles', 'assets/tiles.png', 'assets/tiles.json');
  },

  create: function () {
    this.asset.cropEnabled = false;
  },

  update: function () {
    if (!!this.ready) {
      this.game.state.start('Game', true, false, { test: 1 });
    }
  },

  onLoadComplete: function () {
    this.ready = true;
  },
};

},{}],"/Users/pattra/Documents/dev/GitHub/tactics/src/js/states/splash.js":[function(require,module,exports){
var Splash = function () {
};

module.exports = Splash;

Splash.prototype = {
  create: function () {
  }
};
},{}],"/Users/pattra/Documents/dev/GitHub/tactics/src/js/utils.js":[function(require,module,exports){
var Utils = {
    containsObject: function(obj, list) {
        var i;
        for (i = 0; i < list.length; i++) {
            if (list[i] === obj) {
                return true;
            }
        }

        return false;
    }
};

module.exports = Utils;
},{}]},{},["/Users/pattra/Documents/dev/GitHub/tactics/src/js/main.js"])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvanMvZW50aXRpZXMvY2hhckJhdHRsZURldGFpbC5qcyIsInNyYy9qcy9lbnRpdGllcy9jaGFyQmF0dGxlUHJldmlldy5qcyIsInNyYy9qcy9lbnRpdGllcy9lbmVteUNoYXJhY3Rlci5qcyIsInNyYy9qcy9lbnRpdGllcy9wbGF5ZXJDaGFyYWN0ZXIuanMiLCJzcmMvanMvZW50aXRpZXMvdGlsZS5qcyIsInNyYy9qcy9tYWluLmpzIiwic3JjL2pzL3N0YXRlcy9ib290LmpzIiwic3JjL2pzL3N0YXRlcy9nYW1lLmpzIiwic3JjL2pzL3N0YXRlcy9tZW51LmpzIiwic3JjL2pzL3N0YXRlcy9wcmVsb2FkZXIuanMiLCJzcmMvanMvc3RhdGVzL3NwbGFzaC5qcyIsInNyYy9qcy91dGlscy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQ0FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN6Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMvQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzlEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM5RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3ZCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2hCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDN0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNqY0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzFCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNSQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIid1c2Ugc3RyaWN0JztcblxuY29uc3QgQ2hhckJhdHRsZURldGFpbCA9IGZ1bmN0aW9uIChnYW1lLCB4LCB5LCBwcm9wZXJ0aWVzLCBoYW5kbGVyKSB7XG4gIHRoaXMudml0YWxzID0gZ2FtZS5hZGQuZ3JvdXAoKTtcbiAgdGhpcy52aXRhbHMudmlzaWJsZSA9IGZhbHNlO1xuICB0aGlzLnRleHQgPSB7fTtcbiAgdGhpcy5oYW5kbGVyID0gaGFuZGxlcjtcblxuICBjb25zdCBzdHlsZSA9IHsgZm9udDogJzI0cHggQXJpYWwnLCBmaWxsOiAnI2ZmMDA0NCcgfTtcblxuICAvKiBmdWxsIGRldGFpbCBwYW5lbCAqL1xuICB0aGlzLnRleHQubmFtZSA9IGdhbWUuYWRkLnRleHQoMCwgZ2FtZS53b3JsZC5jZW50ZXJZLCBwcm9wZXJ0aWVzLm5hbWUsIHN0eWxlLCB0aGlzLnZpdGFscyk7XG4gIHRoaXMudGV4dC5ocCA9IGdhbWUuYWRkLnRleHQoMCwgZ2FtZS53b3JsZC5jZW50ZXJZICsgNTAsIHByb3BlcnRpZXMubWF4SFAgKyAnLycgKyBwcm9wZXJ0aWVzLm1heEhQLCBzdHlsZSwgdGhpcy52aXRhbHMpO1xuXG4gIC8qIGFjdGlvbnMgKi9cbiAgdGhpcy50ZXh0Lm1vdmUgPSBnYW1lLmFkZC50ZXh0KDAsIGdhbWUud29ybGQuY2VudGVyWSArIDEwMCwgJ01vdmUgQ2hhcmFjdGVyJywgc3R5bGUsIHRoaXMudml0YWxzKTtcbiAgdGhpcy50ZXh0Lm1vdmUuaW5wdXRFbmFibGVkID0gdHJ1ZTtcbiAgdGhpcy50ZXh0Lm1vdmUuZXZlbnRzLm9uSW5wdXREb3duLmFkZCgoKSA9PiB7IHRoaXMuaGFuZGxlcignbW92ZScpOyB9KTtcblxuICB0aGlzLnRleHQuYXR0YWNrID0gZ2FtZS5hZGQudGV4dCgwLCBnYW1lLndvcmxkLmNlbnRlclkgKyAxNTAsICdBdHRhY2snLCBzdHlsZSwgdGhpcy52aXRhbHMpO1xuICB0aGlzLnRleHQuYXR0YWNrLmlucHV0RW5hYmxlZCA9IHRydWU7XG4gIHRoaXMudGV4dC5hdHRhY2suZXZlbnRzLm9uSW5wdXREb3duLmFkZCgoKSA9PiB7IHRoaXMuaGFuZGxlcignYXR0YWNrJyk7IH0pO1xuXG4gIHRoaXMudG9nZ2xlRGlzcGxheSA9ICgpID0+IHtcbiAgICB0aGlzLnZpdGFscy52aXNpYmxlID0gIXRoaXMudml0YWxzLnZpc2libGU7XG4gIH07XG5cbiAgdGhpcy51cGRhdGVIUCA9IChjdXJyZW50LCBtYXgpID0+IHtcbiAgICB0aGlzLnRleHQuaHAuc2V0VGV4dChjdXJyZW50ICsgJy8nICsgbWF4KTtcbiAgfTtcbn07XG5cbkNoYXJCYXR0bGVEZXRhaWwucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gQ2hhckJhdHRsZURldGFpbDtcblxuLyoqXG4gKiBBdXRvbWF0aWNhbGx5IGNhbGxlZCBieSBXb3JsZC51cGRhdGVcbiAqL1xuQ2hhckJhdHRsZURldGFpbC5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24gKCkge1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBDaGFyQmF0dGxlRGV0YWlsO1xuIiwiJ3VzZSBzdHJpY3QnO1xuXG5jb25zdCBDaGFyQmF0dGxlUHJldmlldyA9IGZ1bmN0aW9uIChnYW1lLCB4LCB5LCBwcm9wZXJ0aWVzKSB7XG4gIHRoaXMudml0YWxzID0gZ2FtZS5hZGQuZ3JvdXAoKTtcbiAgdGhpcy52aXRhbHMudmlzaWJsZSA9IGZhbHNlO1xuICB0aGlzLnRleHQgPSB7fTtcblxuICBjb25zdCBzdHlsZSA9IHsgZm9udDogJzI0cHggQXJpYWwnLCBmaWxsOiAnI2ZmMDA0NCcgfTtcblxuICAvKiBwcmV2aWV3IHBhbmVsICovXG4gIHRoaXMudGV4dC5uYW1lID0gZ2FtZS5hZGQudGV4dChnYW1lLndvcmxkLmNlbnRlclgsIGdhbWUud29ybGQuY2VudGVyWSwgcHJvcGVydGllcy5uYW1lLCBzdHlsZSwgdGhpcy52aXRhbHMpO1xuICB0aGlzLnRleHQuaHAgPSBnYW1lLmFkZC50ZXh0KGdhbWUud29ybGQuY2VudGVyWCwgZ2FtZS53b3JsZC5jZW50ZXJZICsgNTAsIHByb3BlcnRpZXMubWF4SFAgKyAnLycgKyBwcm9wZXJ0aWVzLm1heEhQLCBzdHlsZSwgdGhpcy52aXRhbHMpO1xuXG4gIHRoaXMudG9nZ2xlRGlzcGxheSA9IChjdXJzb3JPbikgPT4ge1xuICAgIHRoaXMudml0YWxzLnZpc2libGUgPSBjdXJzb3JPbjtcbiAgfTtcblxuICB0aGlzLnVwZGF0ZUhQID0gKGN1cnJlbnQsIG1heCkgPT4ge1xuICAgIHRoaXMudGV4dC5ocC5zZXRUZXh0KGN1cnJlbnQgKyAnLycgKyBtYXgpO1xuICB9O1xufTtcblxuQ2hhckJhdHRsZVByZXZpZXcucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gQ2hhckJhdHRsZVByZXZpZXc7XG5cbi8qKlxuICogQXV0b21hdGljYWxseSBjYWxsZWQgYnkgV29ybGQudXBkYXRlXG4gKi9cbkNoYXJCYXR0bGVQcmV2aWV3LnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbiAoKSB7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IENoYXJCYXR0bGVQcmV2aWV3O1xuIiwiJ3VzZSBzdHJpY3QnO1xuXG5jb25zdCBQcmV2aWV3ID0gcmVxdWlyZSgnLi4vZW50aXRpZXMvY2hhckJhdHRsZVByZXZpZXcnKTtcblxuY29uc3QgRW5lbXlDaGFyYWN0ZXIgPSBmdW5jdGlvbiAoZ2FtZSwgeCwgeSwgcHJvcGVydGllcykge1xuICAvKiBQUk9QRVJUSUVTICovXG4gIHRoaXMubG9jID0gcHJvcGVydGllcy5sb2M7XG4gIHRoaXMuaGFuZGxlciA9IHByb3BlcnRpZXMuYWN0aW9uSGFuZGxlcjtcblxuICB0aGlzLnByZXZpZXcgPSBuZXcgUHJldmlldyhnYW1lLCB4LCB5LCBwcm9wZXJ0aWVzKTtcbiAgdGhpcy5uYW1lID0gcHJvcGVydGllcy5uYW1lO1xuICB0aGlzLm1heEhQID0gcHJvcGVydGllcy5tYXhIUDtcbiAgdGhpcy5jdXJyZW50SFAgPSBwcm9wZXJ0aWVzLm1heEhQO1xuXG4gIC8qIEZVTkNUSU9OUyAqL1xuICB0aGlzLm9uSG92ZXIgPSAoY3Vyc29yT24pID0+IHtcbiAgICB0aGlzLnByZXZpZXcudG9nZ2xlRGlzcGxheShjdXJzb3JPbik7XG4gIH07XG5cbiAgLy8gdGhpcy50b2dnbGVTZWxlY3QgPSAoKSA9PiB7XG4gIC8vICAgdGhpcy5kZXRhaWwudG9nZ2xlRGlzcGxheSgpO1xuICAvLyB9O1xuXG4gIHRoaXMuY2hhbmdlSFAgPSAoYW10KSA9PiB7XG4gICAgdGhpcy5jdXJyZW50SFAgPSB0aGlzLmN1cnJlbnRIUCArIGFtdDtcblxuICAgIGlmICh0aGlzLmN1cnJlbnRIUCA8IDEpIHtcbiAgICAgIHRoaXMuc3ByaXRlLmtpbGwoKTtcbiAgICAgIHRoaXMuaGFuZGxlcigna2lsbCcsIHRoaXMubG9jKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5wcmV2aWV3LnVwZGF0ZUhQKHRoaXMuY3VycmVudEhQLCB0aGlzLm1heEhQKTtcbiAgICB9XG4gIH07XG5cbiAgdGhpcy5jaGFuZ2VMb2MgPSAobG9jLCB4LCB5KSA9PiB7XG4gICAgdGhpcy5sb2MgPSBsb2M7XG4gICAgdGhpcy5zcHJpdGUueCA9IHg7XG4gICAgdGhpcy5zcHJpdGUueSA9IHk7XG4gIH07XG5cbiAgdGhpcy5vbkNsaWNrID0gKCkgPT4ge1xuICAgIHRoaXMuaGFuZGxlcignc2VsZWN0JywgdGhpcy5sb2MpO1xuICB9O1xuXG4gIHRoaXMuc3ByaXRlID0gZ2FtZS5hZGQuc3ByaXRlKHgsIHksIHByb3BlcnRpZXMuc3ByaXRlKTtcblxuICB0aGlzLnNwcml0ZS5pbnB1dEVuYWJsZWQgPSB0cnVlO1xuICB0aGlzLnNwcml0ZS5ldmVudHMub25JbnB1dE92ZXIuYWRkKCgpID0+IHsgdGhpcy5vbkhvdmVyKHRydWUpOyB9KTtcbiAgdGhpcy5zcHJpdGUuZXZlbnRzLm9uSW5wdXRPdXQuYWRkKCgpID0+IHsgdGhpcy5vbkhvdmVyKGZhbHNlKTsgfSk7XG4gIHRoaXMuc3ByaXRlLmV2ZW50cy5vbklucHV0RG93bi5hZGQodGhpcy5vbkNsaWNrKTtcbn07XG5cbi8vIENoYXJhY3Rlci5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKFBoYXNlci5TcHJpdGUucHJvdG90eXBlKTtcbkVuZW15Q2hhcmFjdGVyLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IEVuZW15Q2hhcmFjdGVyO1xuXG4vKipcbiAqIEF1dG9tYXRpY2FsbHkgY2FsbGVkIGJ5IFdvcmxkLnVwZGF0ZVxuICovXG5FbmVteUNoYXJhY3Rlci5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24gKCkge1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBFbmVteUNoYXJhY3RlcjtcbiIsIid1c2Ugc3RyaWN0JztcblxuY29uc3QgUHJldmlldyA9IHJlcXVpcmUoJy4uL2VudGl0aWVzL2NoYXJCYXR0bGVQcmV2aWV3Jyk7XG5jb25zdCBEZXRhaWwgPSByZXF1aXJlKCcuLi9lbnRpdGllcy9jaGFyQmF0dGxlRGV0YWlsJyk7XG5cbmNvbnN0IFBsYXllckNoYXJhY3RlciA9IGZ1bmN0aW9uIChnYW1lLCB4LCB5LCBwcm9wZXJ0aWVzKSB7XG4gIC8qIFBST1BFUlRJRVMgKi9cbiAgdGhpcy5sb2MgPSBwcm9wZXJ0aWVzLmxvYztcbiAgdGhpcy5yYW5nZSA9IHByb3BlcnRpZXMucmFuZ2U7XG5cbiAgdGhpcy5oYW5kbGVyID0gcHJvcGVydGllcy5hY3Rpb25IYW5kbGVyO1xuICB0aGlzLlVJSGFuZGxlciA9IChhY3Rpb24sIHBhcmFtcykgPT4ge1xuICAgIGlmIChhY3Rpb24gPT09ICdhdHRhY2snKSB7XG4gICAgICBwYXJhbXMgPSB7IHJhbmdlOiB0aGlzLnJhbmdlIH07XG4gICAgfVxuXG4gICAgaWYgKGFjdGlvbikge1xuICAgICAgdGhpcy5oYW5kbGVyKGFjdGlvbiwgdGhpcy5sb2MsIHBhcmFtcyk7XG4gICAgfVxuICB9O1xuXG4gIHRoaXMucHJldmlldyA9IG5ldyBQcmV2aWV3KGdhbWUsIHgsIHksIHByb3BlcnRpZXMpO1xuICB0aGlzLmRldGFpbCA9IG5ldyBEZXRhaWwoZ2FtZSwgeCwgeSwgcHJvcGVydGllcywgdGhpcy5VSUhhbmRsZXIpO1xuICB0aGlzLm5hbWUgPSBwcm9wZXJ0aWVzLm5hbWU7XG4gIHRoaXMubWF4SFAgPSBwcm9wZXJ0aWVzLm1heEhQO1xuICB0aGlzLmN1cnJlbnRIUCA9IHByb3BlcnRpZXMubWF4SFA7XG4gIHRoaXMuYXR0YWNrID0gcHJvcGVydGllcy5hdHRhY2s7XG5cbiAgLyogRlVOQ1RJT05TICovXG4gIHRoaXMub25Ib3ZlciA9IChjdXJzb3JPbikgPT4ge1xuICAgIHRoaXMucHJldmlldy50b2dnbGVEaXNwbGF5KGN1cnNvck9uKTtcbiAgfTtcblxuICB0aGlzLnRvZ2dsZVNlbGVjdCA9ICgpID0+IHtcbiAgICB0aGlzLmRldGFpbC50b2dnbGVEaXNwbGF5KCk7XG4gIH07XG5cbiAgdGhpcy5jaGFuZ2VIUCA9IChhbXQpID0+IHtcbiAgICB0aGlzLmN1cnJlbnRIUCA9IHRoaXMuY3VycmVudEhQICsgYW10O1xuXG4gICAgaWYgKHRoaXMuY3VycmVudEhQIDwgMSkge1xuICAgICAgdGhpcy5zcHJpdGUua2lsbCgpO1xuICAgICAgdGhpcy5oYW5kbGVyKCdraWxsJywgdGhpcy5sb2MpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnByZXZpZXcudXBkYXRlSFAodGhpcy5jdXJyZW50SFAsIHRoaXMubWF4SFApO1xuICAgICAgdGhpcy5kZXRhaWwudXBkYXRlSFAodGhpcy5jdXJyZW50SFAsIHRoaXMubWF4SFApO1xuICAgIH1cbiAgfTtcblxuICB0aGlzLmNoYW5nZUxvYyA9IChsb2MsIHgsIHkpID0+IHtcbiAgICB0aGlzLmxvYyA9IGxvYztcbiAgICB0aGlzLnNwcml0ZS54ID0geDtcbiAgICB0aGlzLnNwcml0ZS55ID0geTtcbiAgfTtcblxuICB0aGlzLm9uQ2xpY2sgPSAoKSA9PiB7XG4gICAgdGhpcy5oYW5kbGVyKCdzZWxlY3QnLCB0aGlzLmxvYyk7XG4gICAgdGhpcy5kZXRhaWwudG9nZ2xlRGlzcGxheSgpO1xuICB9O1xuXG4gIHRoaXMuc3ByaXRlID0gZ2FtZS5hZGQuc3ByaXRlKHgsIHksIHByb3BlcnRpZXMuc3ByaXRlKTtcblxuICB0aGlzLnNwcml0ZS5pbnB1dEVuYWJsZWQgPSB0cnVlO1xuICB0aGlzLnNwcml0ZS5ldmVudHMub25JbnB1dE92ZXIuYWRkKCgpID0+IHsgdGhpcy5vbkhvdmVyKHRydWUpOyB9KTtcbiAgdGhpcy5zcHJpdGUuZXZlbnRzLm9uSW5wdXRPdXQuYWRkKCgpID0+IHsgdGhpcy5vbkhvdmVyKGZhbHNlKTsgfSk7XG4gIHRoaXMuc3ByaXRlLmV2ZW50cy5vbklucHV0RG93bi5hZGQodGhpcy5vbkNsaWNrKTtcbn07XG5cbi8vIENoYXJhY3Rlci5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKFBoYXNlci5TcHJpdGUucHJvdG90eXBlKTtcblBsYXllckNoYXJhY3Rlci5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBQbGF5ZXJDaGFyYWN0ZXI7XG5cbi8qKlxuICogQXV0b21hdGljYWxseSBjYWxsZWQgYnkgV29ybGQudXBkYXRlXG4gKi9cblBsYXllckNoYXJhY3Rlci5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24gKCkge1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBQbGF5ZXJDaGFyYWN0ZXI7XG4iLCIndXNlIHN0cmljdCc7XG5cbmNvbnN0IFRpbGUgPSBmdW5jdGlvbiAoZ2FtZSwgeCwgeSkge1xuICB0aGlzLnN0YXR1cyA9ICdkZWZhdWx0JztcbiAgdGhpcy5kZWZhdWx0U3RhdGUgPSAnZ3Jhc3MnO1xuXG4gIHRoaXMuc2V0U3RhdHVzID0gKGZyYW1lTmFtZSwgc3RhdHVzKSA9PiB7XG4gICAgdGhpcy5mcmFtZU5hbWUgPSBmcmFtZU5hbWUgPT09ICdkZWZhdWx0JyA/IHRoaXMuZGVmYXVsdFN0YXRlIDogZnJhbWVOYW1lO1xuICAgIHRoaXMuc3RhdHVzID0gc3RhdHVzID8gc3RhdHVzIDogZnJhbWVOYW1lOyAvLyBkb2Vzbid0IGN1cnJlbnRseSBkbyBhbnl0aGluZ1xuICB9O1xuXG4gIFBoYXNlci5TcHJpdGUuY2FsbCh0aGlzLCBnYW1lLCB4LCB5LCAndGlsZXMnLCAnZ3Jhc3MnKTtcblxuICBnYW1lLmFkZC5leGlzdGluZyh0aGlzKTtcbn07XG5cblRpbGUucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShQaGFzZXIuU3ByaXRlLnByb3RvdHlwZSk7XG5UaWxlLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IFRpbGU7XG5cblRpbGUucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gVGlsZTtcbiIsIid1c2Ugc3RyaWN0JztcblxudmFyIGdhbWUgPSBuZXcgUGhhc2VyLkdhbWUoODAwLCA2MDAsIFBoYXNlci5BVVRPLCAndGFjdGljcy1nYW1lJyk7XG5cbndpbmRvdy5VdGlscyA9IHJlcXVpcmUoJy4vdXRpbHMnKTtcbndpbmRvdy5wbGF5ZXJTdGF0ZSA9IHtcbiAgY3VycmVudExldmVsOiAnR2FtZScsXG59O1xuXG5nYW1lLnN0YXRlLmFkZCgnQm9vdCcsIHJlcXVpcmUoJy4vc3RhdGVzL2Jvb3QnKSk7XG5nYW1lLnN0YXRlLmFkZCgnU3BsYXNoJywgcmVxdWlyZSgnLi9zdGF0ZXMvc3BsYXNoJykpO1xuZ2FtZS5zdGF0ZS5hZGQoJ1ByZWxvYWRlcicsIHJlcXVpcmUoJy4vc3RhdGVzL3ByZWxvYWRlcicpKTtcbmdhbWUuc3RhdGUuYWRkKCdNZW51JywgcmVxdWlyZSgnLi9zdGF0ZXMvbWVudScpKTtcbmdhbWUuc3RhdGUuYWRkKCdHYW1lJywgcmVxdWlyZSgnLi9zdGF0ZXMvZ2FtZScpKTtcblxuZ2FtZS5zdGF0ZS5zdGFydCgnQm9vdCcpO1xuIiwidmFyIEJvb3QgPSBmdW5jdGlvbiAoKSB7fTtcblxubW9kdWxlLmV4cG9ydHMgPSBCb290O1xuXG5Cb290LnByb3RvdHlwZSA9IHtcblxuICBwcmVsb2FkOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5sb2FkLmltYWdlKCdwcmVsb2FkZXInLCAnYXNzZXRzL3ByZWxvYWRlci5naWYnKTtcbiAgfSxcblxuICBjcmVhdGU6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmdhbWUuaW5wdXQubWF4UG9pbnRlcnMgPSAxO1xuXG4gICAgaWYgKHRoaXMuZ2FtZS5kZXZpY2UuZGVza3RvcCkge1xuICAgICAgdGhpcy5nYW1lLnN0YWdlLnNjYWxlLnBhZ2VBbGlnbkhvcml6b250YWxseSA9IHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuZ2FtZS5zY2FsZS5zY2FsZU1vZGUgPSBQaGFzZXIuU2NhbGVNYW5hZ2VyLlNIT1dfQUxMO1xuICAgICAgdGhpcy5nYW1lLnNjYWxlLm1pbldpZHRoID0gIDQ4MDtcbiAgICAgIHRoaXMuZ2FtZS5zY2FsZS5taW5IZWlnaHQgPSAyNjA7XG4gICAgICB0aGlzLmdhbWUuc2NhbGUubWF4V2lkdGggPSA2NDA7XG4gICAgICB0aGlzLmdhbWUuc2NhbGUubWF4SGVpZ2h0ID0gNDgwO1xuICAgICAgdGhpcy5nYW1lLnNjYWxlLmZvcmNlTGFuZHNjYXBlID0gdHJ1ZTtcbiAgICAgIHRoaXMuZ2FtZS5zY2FsZS5wYWdlQWxpZ25Ib3Jpem9udGFsbHkgPSB0cnVlO1xuICAgICAgdGhpcy5nYW1lLnNjYWxlLnNldFNjcmVlblNpemUodHJ1ZSk7XG4gICAgfVxuXG4gICAgdGhpcy5nYW1lLnN0YXRlLnN0YXJ0KCdQcmVsb2FkZXInKTtcbiAgfVxufTtcbiIsIid1c2Ugc3RyaWN0JztcblxuY29uc3QgUGxheWVyQ2hhcmFjdGVyID0gcmVxdWlyZSgnLi4vZW50aXRpZXMvcGxheWVyQ2hhcmFjdGVyJyk7XG5jb25zdCBFbmVteUNoYXJhY3RlciA9IHJlcXVpcmUoJy4uL2VudGl0aWVzL2VuZW15Q2hhcmFjdGVyJyk7XG5jb25zdCBUaWxlID0gcmVxdWlyZSgnLi4vZW50aXRpZXMvdGlsZScpO1xuXG5jb25zdCBNQVBfU0laRSA9IDM7XG5jb25zdCBNQVBfVE9UQUxfVElMRVMgPSA5O1xuXG5jb25zdCBQTEFZRVJfRklMRSA9IHtcbiAgcGFydHk6IFtcbiAgICB7XG4gICAgICBuYW1lOiAnU29iZWwnLFxuICAgICAgbWF4SFA6IDEwLFxuICAgICAgaXNQbGF5ZXI6IHRydWUsXG4gICAgICBsb2M6IDMsXG4gICAgICBhdHRhY2s6IDEsXG4gICAgICByYW5nZTogJ3BpZXJjZScsXG4gICAgfSxcbiAgICB7XG4gICAgICBuYW1lOiAnRmVucmlzJyxcbiAgICAgIG1heEhQOiAxNSxcbiAgICAgIGxvYzogNSxcbiAgICAgIGF0dGFjazogMyxcbiAgICAgIHJhbmdlOiAnc3dpbmcnLFxuICAgIH0sXG4gICAge1xuICAgICAgbmFtZTogJ0NvcnJpbicsXG4gICAgICBtYXhIUDogMTUsXG4gICAgICBsb2M6IDIsXG4gICAgICBhdHRhY2s6IDIsXG4gICAgICByYW5nZTogJ3JlYWNoJyxcbiAgICB9LFxuICBdLFxufTtcblxuY29uc3QgTEVWRUxfTUFQID0ge1xuICBlbmVtaWVzOiBbXG4gICAge1xuICAgICAgbmFtZTogJ2JhZGRpZSAxJyxcbiAgICAgIG1heEhQOiAzLFxuICAgICAgbG9jOiAwLFxuICAgIH0sXG4gICAge1xuICAgICAgbmFtZTogJ2JhZGRpZSAyJyxcbiAgICAgIG1heEhQOiA1LFxuICAgICAgbG9jOiA3LFxuICAgIH0sXG4gICAge1xuICAgICAgbmFtZTogJ2JhZGRpZSAzJyxcbiAgICAgIG1heEhQOiAzLFxuICAgICAgbG9jOiAxLFxuICAgIH0sXG4gICAge1xuICAgICAgbmFtZTogJ2JhZGRpZSA0JyxcbiAgICAgIG1heEhQOiAzLFxuICAgICAgbG9jOiAyLFxuICAgIH0sXG4gICAge1xuICAgICAgbmFtZTogJ2JhZGRpZSA1JyxcbiAgICAgIG1heEhQOiAzLFxuICAgICAgbG9jOiAzLFxuICAgIH0sXG4gIF0sXG59O1xuXG5jb25zdCBHYW1lID0gZnVuY3Rpb24gKCkge1xuICB0aGlzLmNoYXJGb2N1cyA9IG51bGw7XG4gIHRoaXMucGxheWVyTWFwID0gW107XG4gIHRoaXMuZW5lbXlNYXAgPSBbXTtcblxuICB0aGlzLmdldEVuZW15VGFyZ2V0cyA9IHtcbiAgICBtZWxlZTogZnVuY3Rpb24gKG9yaWdpbikge1xuICAgICAgLyogWyBdWyBdWyBdXG4gICAgICAgICBbeF1bIF1bIF1cbiAgICAgICAgIFsgXVsgXVsgXSAqL1xuICAgICAgY29uc3QgdGFyZ2V0YWJsZSA9IFtdO1xuICAgICAgY29uc3QgbWFwID0gdGhpcy5lbmVteU1hcDtcbiAgICAgIGxldCBpbmRleDtcblxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBNQVBfU0laRTsgaSsrKSB7XG4gICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgTUFQX1NJWkU7IGorKykge1xuICAgICAgICAgIGluZGV4ID0gaSAqIE1BUF9TSVpFICsgajtcbiAgICAgICAgICBpZiAobWFwW2luZGV4XS5jaGFyYWN0ZXIpIHtcbiAgICAgICAgICAgIHRhcmdldGFibGUucHVzaChpbmRleCk7XG4gICAgICAgICAgICB0aGlzLl9zZXRVcFRhcmdldChtYXAsIG9yaWdpbiwgaW5kZXgsIFtdKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gdGFyZ2V0YWJsZTtcbiAgICB9LFxuXG4gICAgcmFuZ2VkOiBmdW5jdGlvbiAob3JpZ2luKSB7XG4gICAgICAvKiBbIF1bIF1bIF1cbiAgICAgICAgIFsgXVt4XVsgXSAoYW55KVxuICAgICAgICAgWyBdWyBdWyBdICovXG4gICAgICBjb25zdCBtYXAgPSB0aGlzLmVuZW15TWFwO1xuXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IE1BUF9UT1RBTF9USUxFUzsgaSsrKSB7XG4gICAgICAgIGlmIChtYXBbaV0uY2hhcmFjdGVyKSB7XG4gICAgICAgICAgdGFyZ2V0YWJsZS5wdXNoKGkpO1xuICAgICAgICAgIHRoaXMuX3NldFVwVGFyZ2V0KG1hcCwgb3JpZ2luLCBpLCBbXSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuXG4gICAgcmVhY2g6IGZ1bmN0aW9uIChvcmlnaW4pIHtcbiAgICAgIC8qIFsgXVsgXVsgXVxuICAgICAgICAgW3hdW3hdWyBdXG4gICAgICAgICBbIF1bIF1bIF0gKi9cbiAgICAgIGNvbnN0IG1hcCA9IHRoaXMuZW5lbXlNYXA7XG4gICAgICBsZXQgaW5kZXg7XG4gICAgICBsZXQgcmVhY2hJbmRleDtcblxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBNQVBfU0laRTsgaSsrKSB7XG4gICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgTUFQX1NJWkU7IGorKykge1xuICAgICAgICAgIGluZGV4ID0gaSAqIE1BUF9TSVpFICsgajtcbiAgICAgICAgICBpZiAobWFwW2luZGV4XS5jaGFyYWN0ZXIpIHtcbiAgICAgICAgICAgIHJlYWNoSW5kZXggPSBpbmRleCArIDE7XG4gICAgICAgICAgICBpZiAocmVhY2hJbmRleCAlIE1BUF9TSVpFICE9PSAwKSB7XG4gICAgICAgICAgICAgIHRoaXMuX3NldFVwVGFyZ2V0KG1hcCwgb3JpZ2luLCBpbmRleCwgW3JlYWNoSW5kZXhdKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHRoaXMuX3NldFVwVGFyZ2V0KG1hcCwgb3JpZ2luLCBpbmRleCwgW10pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0YXJnZXRhYmxlLnB1c2goaW5kZXgpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcblxuICAgIHBpZXJjZTogZnVuY3Rpb24gKG9yaWdpbikge1xuICAgICAgLyogWyBdWyBdWyBdXG4gICAgICAgICBbeF1beF1beF1cbiAgICAgICAgIFsgXVsgXVsgXSAqL1xuICAgICAgY29uc3QgbWFwID0gdGhpcy5lbmVteU1hcDtcbiAgICAgIGxldCBpbmRleDtcbiAgICAgIGxldCBuZWlnaGJvcnMgPSBbXTtcblxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBNQVBfU0laRTsgaSsrKSB7XG4gICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgTUFQX1NJWkU7IGorKykge1xuICAgICAgICAgIGluZGV4ID0gaSAqIE1BUF9TSVpFICsgajtcbiAgICAgICAgICBpZiAobWFwW2luZGV4XS5jaGFyYWN0ZXIpIHtcbiAgICAgICAgICAgIG5laWdoYm9ycyA9IFtdO1xuICAgICAgICAgICAgZm9yIChsZXQgayA9IGkgKiBNQVBfU0laRTsgayA8IChpICsgMSkgKiBNQVBfU0laRTsgaysrKSB7XG4gICAgICAgICAgICAgIGlmIChrICE9PSBpbmRleCkgbmVpZ2hib3JzLnB1c2goayk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuX3NldFVwVGFyZ2V0KG1hcCwgb3JpZ2luLCBpbmRleCwgbmVpZ2hib3JzKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuXG4gICAgc3ByZWFkOiBmdW5jdGlvbiAoKSB7XG4gICAgICAvKiBbIF1beF1bIF1cbiAgICAgICAgIFt4XVt4XVt4XVxuICAgICAgICAgWyBdW3hdWyBdICovXG4gICAgICBjb25zdCBtYXAgPSB0aGlzLmVuZW15TWFwO1xuICAgICAgbGV0IGluZGV4O1xuICAgICAgbGV0IG5laWdoYm9ycyA9IFtdO1xuICAgIH0sXG5cbiAgICBzd2luZzogZnVuY3Rpb24gKG9yaWdpbikge1xuICAgICAgLyogW09dWyBdW3hdXG4gICAgICAgICBbeF1beF1bT11cbiAgICAgICAgIFsgXVtPXVt4XSAqL1xuICAgICAgY29uc3QgbWFwID0gdGhpcy5lbmVteU1hcDtcbiAgICAgIGxldCBpbmRleDtcbiAgICAgIGxldCBuZWlnaGJvcnMgPSBbXTtcbiAgICAgIGxldCB0b3BJbmRleDtcbiAgICAgIGxldCBib3RJbmRleDtcblxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBNQVBfU0laRTsgaSsrKSB7XG4gICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgTUFQX1NJWkU7IGorKykge1xuICAgICAgICAgIG5laWdoYm9ycyA9IFtdO1xuICAgICAgICAgIGluZGV4ID0gaSAqIE1BUF9TSVpFICsgajtcblxuICAgICAgICAgIGlmIChtYXBbaW5kZXhdLmNoYXJhY3Rlcikge1xuICAgICAgICAgICAgdG9wSW5kZXggPSBpbmRleCAtIE1BUF9TSVpFO1xuICAgICAgICAgICAgYm90SW5kZXggPSBpbmRleCArIE1BUF9TSVpFO1xuXG4gICAgICAgICAgICBpZiAodG9wSW5kZXggPiAtMSkgbmVpZ2hib3JzLnB1c2goaW5kZXggLSBNQVBfU0laRSk7XG4gICAgICAgICAgICBpZiAoYm90SW5kZXggPCBNQVBfVE9UQUxfVElMRVMpIG5laWdoYm9ycy5wdXNoKGluZGV4ICsgTUFQX1NJWkUpO1xuXG4gICAgICAgICAgICB0aGlzLl9zZXRVcFRhcmdldChtYXAsIG9yaWdpbiwgaW5kZXgsIG5laWdoYm9ycyk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuXG4gICAgaW1wYWN0OiBmdW5jdGlvbiAob3JpZ2luKSB7XG4gICAgICAvKiBbeF1bIF1bIF1cbiAgICAgICAgIFt4XVsgXVsgXVxuICAgICAgICAgW3hdWyBdWyBdICovXG4gICAgICBjb25zdCBtYXAgPSB0aGlzLmVuZW15TWFwO1xuICAgICAgbGV0IGluZGV4O1xuICAgICAgbGV0IG5laWdoYm9ycyA9IFtdO1xuXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IE1BUF9TSVpFOyBpKyspIHtcbiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBNQVBfU0laRTsgaisrKSB7XG4gICAgICAgICAgaW5kZXggPSBpICogTUFQX1NJWkUgKyBqO1xuICAgICAgICAgIGlmIChtYXBbaW5kZXhdLmNoYXJhY3Rlcikge1xuICAgICAgICAgICAgbmVpZ2hib3JzID0gW107XG5cbiAgICAgICAgICAgIGZvciAobGV0IGsgPSBqOyBrIDwgKGogKyAxICsgKE1BUF9TSVpFICogKE1BUF9TSVpFIC0gMSkpKTsgayArPSAzKSB7XG4gICAgICAgICAgICAgIGlmIChrICE9PSBpbmRleCkgbmVpZ2hib3JzLnB1c2goayk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuX3NldFVwVGFyZ2V0KG1hcCwgb3JpZ2luLCBpbmRleCwgbmVpZ2hib3JzKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG5cbiAgICBhbGw6IGZ1bmN0aW9uICgpIHtcbiAgICAgIC8qIFt4XVt4XVt4XVxuICAgICAgICAgW3hdW3hdW3hdXG4gICAgICAgICBbeF1beF1beF0gKi9cbiAgICB9LFxuICB9O1xuXG4gIHRoaXMuZ2V0UGxheWVyVGFyZ2V0cyA9IHtcbiAgICBtZWxlZTogZnVuY3Rpb24gKG1hcCkge1xuICAgICAgLyogWyBdWyBdWyBdXG4gICAgICAgICBbeF1bIF1bIF1cbiAgICAgICAgIFsgXVsgXVsgXSAqL1xuICAgICAgbGV0IGluZGV4O1xuICAgICAgbGV0IHRhcmdldGFibGUgPSBbXTtcblxuICAgICAgZm9yIChsZXQgaSA9IE1BUF9TSVpFIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgICAgZm9yIChsZXQgaiA9IE1BUF9TSVpFIC0gMTsgaiA+PSAwOyBqLS0pIHtcbiAgICAgICAgICBpbmRleCA9IGkgKiBNQVBfU0laRSArIGo7XG4gICAgICAgICAgaWYgKG1hcFtpbmRleF0uY2hhcmFjdGVyKSB7XG4gICAgICAgICAgICB0YXJnZXRhYmxlLnB1c2goaW5kZXgpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0YXJnZXRhYmxlO1xuICAgIH0sXG4gIH07XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IEdhbWU7XG5cbkdhbWUucHJvdG90eXBlID0ge1xuXG4gIGluaXQ6IGZ1bmN0aW9uIChwYXJhbSkge1xuICAgIC8vIGNvbnNvbGUubG9nKHBhcmFtKTtcbiAgfSxcblxuICBjcmVhdGU6IGZ1bmN0aW9uICgpIHtcbiAgICBjb25zdCBtYXBPZmZzZXQgPSA0MDA7XG4gICAgbGV0IGk7XG4gICAgbGV0IGo7XG5cbiAgICAvKiBJTklUIFRJTEVTICovXG4gICAgZm9yIChpID0gMDsgaSA8IE1BUF9TSVpFOyBpKyspIHtcbiAgICAgIGZvciAoaiA9IDA7IGogPCBNQVBfU0laRTsgaisrKSB7XG4gICAgICAgIGxldCBwbGF5ZXJUaWxlO1xuICAgICAgICBsZXQgZW5lbXlUaWxlO1xuXG4gICAgICAgIC8vIHBsYXllciB0aWxlc1xuICAgICAgICBwbGF5ZXJUaWxlID0gbmV3IFRpbGUodGhpcy5nYW1lLCBqICogMTAwLCBpICogMTAwKTtcbiAgICAgICAgdGhpcy5wbGF5ZXJNYXAucHVzaCh7XG4gICAgICAgICAgdGlsZTogcGxheWVyVGlsZSxcbiAgICAgICAgICB4OiBqICogMTAwLFxuICAgICAgICAgIHk6IGkgKiAxMDAsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIGVuZW15IHRpbGVzXG4gICAgICAgIGVuZW15VGlsZSA9IG5ldyBUaWxlKHRoaXMuZ2FtZSwgaiAqIDEwMCArIG1hcE9mZnNldCwgaSAqIDEwMCk7XG4gICAgICAgIHRoaXMuZW5lbXlNYXAucHVzaCh7XG4gICAgICAgICAgdGlsZTogZW5lbXlUaWxlLFxuICAgICAgICAgIHg6IGogKiAxMDAgKyBtYXBPZmZzZXQsXG4gICAgICAgICAgeTogaSAqIDEwMCxcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLyogSU5JVCBDSEFSQUNURVJTICovXG4gICAgUExBWUVSX0ZJTEUucGFydHkuZm9yRWFjaCgoY2hhciwgaW5kZXgpID0+IHtcbiAgICAgIC8vIFRPRE86IGVycm9yIGNoZWNraW5nIGZvciBsb2NhdGlvbiBvdmVybGFwc1xuICAgICAgbGV0IHNsb3QgPSB0aGlzLnBsYXllck1hcFtjaGFyLmxvY107XG4gICAgICBzbG90LmNoYXJhY3RlciA9IG5ldyBQbGF5ZXJDaGFyYWN0ZXIodGhpcy5nYW1lLCBzbG90LngsIHNsb3QueSwgT2JqZWN0LmFzc2lnbihjaGFyLCB7XG4gICAgICAgIHRlYW06ICdhbGx5JyxcbiAgICAgICAgc3ByaXRlOiAnYWxseScsXG4gICAgICAgIGFjdGlvbkhhbmRsZXI6IHRoaXMuX3BsYXllckFjdGlvbkhhbmRsZXIuYmluZCh0aGlzKSxcbiAgICAgIH0pKTtcbiAgICB9KTtcblxuICAgIC8qIElOSVQgQkFERElFUyAqL1xuICAgIExFVkVMX01BUC5lbmVtaWVzLmZvckVhY2goKGNoYXIsIGluZGV4KSA9PiB7XG4gICAgICBsZXQgc2xvdCA9IHRoaXMuZW5lbXlNYXBbY2hhci5sb2NdO1xuICAgICAgc2xvdC5jaGFyYWN0ZXIgPSBuZXcgRW5lbXlDaGFyYWN0ZXIodGhpcy5nYW1lLCBzbG90LngsIHNsb3QueSwgT2JqZWN0LmFzc2lnbihjaGFyLCB7XG4gICAgICAgIHRlYW06ICdlbmVteScsXG4gICAgICAgIHNwcml0ZTogJ2VuZW15JyxcbiAgICAgICAgYWN0aW9uSGFuZGxlcjogdGhpcy5fZW5lbXlBY3Rpb25IYW5kbGVyLmJpbmQodGhpcyksXG4gICAgICB9KSk7XG4gICAgfSk7XG4gIH0sXG5cbiAgdXBkYXRlOiBmdW5jdGlvbiAoKSB7XG4gIH0sXG5cbiAgX3NlbGVjdENoYXJhY3RlcjogZnVuY3Rpb24gKGNoYXJhY3Rlcikge1xuICAgIGlmICh0aGlzLmNoYXJGb2N1cyAmJiB0aGlzLmNoYXJGb2N1cyAhPT0gY2hhcmFjdGVyLmxvY1xuICAgICAgICAmJiB0aGlzLnBsYXllck1hcFt0aGlzLmNoYXJGb2N1c10uY2hhcmFjdGVyKSB7XG4gICAgICB0aGlzLnBsYXllck1hcFt0aGlzLmNoYXJGb2N1c10uY2hhcmFjdGVyLnRvZ2dsZVNlbGVjdCgpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmNoYXJGb2N1cyAmJiB0aGlzLnBsYXllck1hcFt0aGlzLmNoYXJGb2N1c10uY2hhcmFjdGVyID09PSBjaGFyYWN0ZXIpIHtcbiAgICAgIHRoaXMuY2hhckZvY3VzID0gbnVsbDtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5jaGFyRm9jdXMgPSBjaGFyYWN0ZXIubG9jO1xuICAgIH1cbiAgfSxcblxuICBfZW5hYmxlVGFyZ2V0aW5nOiBmdW5jdGlvbiAob3JpZ2luLCByYW5nZSkge1xuICAgIHRoaXMuZ2V0RW5lbXlUYXJnZXRzW3JhbmdlXS5iaW5kKHRoaXMpKG9yaWdpbik7XG4gIH0sXG5cbiAgX2VuYWJsZU1vdmU6IGZ1bmN0aW9uIChsb2MpIHtcbiAgICB0aGlzLnBsYXllck1hcC5mb3JFYWNoKCh2YWwsIGluZGV4KSA9PiB7XG4gICAgICB2YWwudGlsZS5pbnB1dEVuYWJsZWQgPSB0cnVlO1xuICAgICAgaWYgKHZhbC5jaGFyYWN0ZXIpIHtcbiAgICAgICAgdmFsLmNoYXJhY3Rlci5zcHJpdGUuZXZlbnRzLm9uSW5wdXREb3duLnJlbW92ZUFsbCgpO1xuICAgICAgICB2YWwuY2hhcmFjdGVyLnNwcml0ZS5ldmVudHMub25JbnB1dERvd24uYWRkKCgpID0+IHsgdGhpcy5fbW92ZUNoYXJhY3Rlcihsb2MsIGluZGV4KTsgfSk7XG4gICAgICB9XG5cbiAgICAgIHZhbC50aWxlLnNldFN0YXR1cygnc2VsZWN0Jyk7XG4gICAgICB2YWwudGlsZS5ldmVudHMub25JbnB1dERvd24uYWRkKCgpID0+IHsgdGhpcy5fbW92ZUNoYXJhY3Rlcihsb2MsIGluZGV4KTsgfSk7XG4gICAgfSk7XG4gIH0sXG5cbiAgX21vdmVDaGFyYWN0ZXI6IGZ1bmN0aW9uIChvcmlnaW4sIHRhcmdldCkge1xuICAgIGNvbnN0IG9yaWdpblNsb3QgPSB0aGlzLnBsYXllck1hcFtvcmlnaW5dO1xuICAgIGNvbnN0IHRhcmdldFNsb3QgPSB0aGlzLnBsYXllck1hcFt0YXJnZXRdO1xuICAgIGNvbnN0IGNoYXIgPSBvcmlnaW5TbG90LmNoYXJhY3RlcjtcbiAgICBjb25zdCBzd2FwQ2hhciA9IHRhcmdldFNsb3QuY2hhcmFjdGVyO1xuXG4gICAgaWYgKCEhY2hhciAmJiAhIWNoYXIubmFtZSkgY2hhci5jaGFuZ2VMb2ModGFyZ2V0LCB0YXJnZXRTbG90LngsIHRhcmdldFNsb3QueSk7XG4gICAgdGhpcy5wbGF5ZXJNYXBbdGFyZ2V0XS5jaGFyYWN0ZXIgPSBjaGFyO1xuICAgIHRoaXMucGxheWVyTWFwW29yaWdpbl0uY2hhcmFjdGVyID0gbnVsbDtcbiAgICBpZiAoISFzd2FwQ2hhciAmJiAhIXN3YXBDaGFyLm5hbWUpIHtcbiAgICAgIHN3YXBDaGFyLmNoYW5nZUxvYyhvcmlnaW4sIG9yaWdpblNsb3QueCwgb3JpZ2luU2xvdC55KTtcbiAgICAgIHRoaXMucGxheWVyTWFwW29yaWdpbl0uY2hhcmFjdGVyID0gc3dhcENoYXI7XG4gICAgfVxuXG4gICAgdGhpcy5wbGF5ZXJNYXAuZm9yRWFjaCgodmFsKSA9PiB7XG4gICAgICB2YWwudGlsZS5zZXRTdGF0dXMoJ2RlZmF1bHQnKTtcbiAgICAgIHZhbC50aWxlLmV2ZW50cy5vbklucHV0RG93bi5yZW1vdmVBbGwoKTtcbiAgICAgIGlmICh2YWwuY2hhcmFjdGVyKSB7XG4gICAgICAgIHZhbC5jaGFyYWN0ZXIuc3ByaXRlLmV2ZW50cy5vbklucHV0RG93bi5yZW1vdmVBbGwoKTtcbiAgICAgICAgdmFsLmNoYXJhY3Rlci5zcHJpdGUuZXZlbnRzLm9uSW5wdXREb3duLmFkZCh2YWwuY2hhcmFjdGVyLm9uQ2xpY2spO1xuICAgICAgICB2YWwuY2hhcmFjdGVyLm9uSG92ZXIoZmFsc2UpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgdGhpcy5jaGFyRm9jdXMgPSB0YXJnZXQ7XG4gIH0sXG5cbiAgX3RhcmdldENoYXJhY3RlcjogZnVuY3Rpb24gKG9yaWdpbiwgdGFyZ2V0KSB7XG4gICAgY29uc29sZS5sb2coJ29yaWdpbicsIG9yaWdpbiwgJ21hcCcsIHRoaXMucGxheWVyTWFwKTtcbiAgICBsZXQgY2xlYXJNYXAgPSB0aGlzLmVuZW15TWFwO1xuICAgIGxldCBhY3RvciA9IHRoaXMucGxheWVyTWFwW29yaWdpbl0uY2hhcmFjdGVyO1xuICAgIGxldCByZWNpcCA9IHRoaXMuZW5lbXlNYXBbdGFyZ2V0XS5jaGFyYWN0ZXI7XG5cbiAgICByZWNpcC5jaGFuZ2VIUCgtMSAqIGFjdG9yLmF0dGFjayk7XG4gICAgdGhpcy5fY2xlYXJNYXAoY2xlYXJNYXApO1xuICB9LFxuXG4gIF9jbGVhck1hcDogZnVuY3Rpb24gKG1hcCkge1xuICAgIG1hcC5mb3JFYWNoKCh2YWwsIGluZGV4KSA9PiB7XG4gICAgICBpZiAodmFsLmNoYXJhY3RlcikgdmFsLmNoYXJhY3Rlci5zcHJpdGUuZXZlbnRzLm9uSW5wdXREb3duLnJlbW92ZUFsbCgpO1xuICAgICAgdmFsLnRpbGUuZXZlbnRzLm9uSW5wdXREb3duLnJlbW92ZUFsbCgpO1xuICAgICAgdmFsLnRpbGUuc2V0U3RhdHVzKCdkZWZhdWx0Jyk7XG4gICAgfSk7XG4gIH0sXG5cbiAgX3NldFVwVGFyZ2V0OiBmdW5jdGlvbiAobWFwLCBvcmlnaW4sIGxvYywgbmVpZ2hib3JzKSB7XG4gICAgbGV0IHZhbCA9IG1hcFtsb2NdO1xuXG4gICAgdmFsLmNoYXJhY3Rlci5zcHJpdGUuZXZlbnRzLm9uSW5wdXREb3duLnJlbW92ZUFsbCgpO1xuICAgIHZhbC5jaGFyYWN0ZXIuc3ByaXRlLmV2ZW50cy5vbklucHV0RG93bi5hZGQoKCkgPT4geyB0aGlzLl90YXJnZXRDaGFyYWN0ZXIob3JpZ2luLCBsb2MpOyB9KTtcblxuICAgIHZhbC50aWxlLmlucHV0RW5hYmxlZCA9IHRydWU7XG4gICAgdmFsLnRpbGUuZXZlbnRzLm9uSW5wdXREb3duLmFkZCgoKSA9PiB7IHRoaXMuX3RhcmdldENoYXJhY3RlcihvcmlnaW4sIGxvYyk7IH0pO1xuICAgIHRoaXMuX3NldFRpbGVIb3ZlcihtYXAsIHZhbC50aWxlLCB2YWwuY2hhcmFjdGVyLnNwcml0ZSwgJ2F0dGFjaycsIG5laWdoYm9ycyk7XG4gIH0sXG5cbiAgX3NldFRpbGVIb3ZlcjogZnVuY3Rpb24gKG1hcCwgdGlsZSwgY2hhciwgZnJhbWVOYW1lLCBuZWlnaGJvcnMpIHtcbiAgICB0aWxlLmV2ZW50cy5vbklucHV0T3Zlci5hZGQoKCkgPT4ge1xuICAgICAgdGlsZS5zZXRTdGF0dXMoZnJhbWVOYW1lKTtcbiAgICAgIG5laWdoYm9ycy5mb3JFYWNoKChuKSA9PiB7XG4gICAgICAgIG1hcFtuXS50aWxlLnNldFN0YXR1cygnYWZmZWN0Jyk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIHRpbGUuZXZlbnRzLm9uSW5wdXRPdXQuYWRkKCgpID0+IHtcbiAgICAgIHRpbGUuc2V0U3RhdHVzKCdkZWZhdWx0Jyk7XG4gICAgICBuZWlnaGJvcnMuZm9yRWFjaCgobikgPT4ge1xuICAgICAgICBtYXBbbl0udGlsZS5zZXRTdGF0dXMoJ2RlZmF1bHQnKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgY2hhci5ldmVudHMub25JbnB1dE92ZXIuYWRkKCgpID0+IHtcbiAgICAgIHRpbGUuc2V0U3RhdHVzKGZyYW1lTmFtZSk7XG4gICAgICBuZWlnaGJvcnMuZm9yRWFjaCgobikgPT4ge1xuICAgICAgICBtYXBbbl0udGlsZS5zZXRTdGF0dXMoJ2FmZmVjdCcpO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBjaGFyLmV2ZW50cy5vbklucHV0T3V0LmFkZCgoKSA9PiB7XG4gICAgICB0aWxlLnNldFN0YXR1cygnZGVmYXVsdCcpO1xuICAgICAgbmVpZ2hib3JzLmZvckVhY2goKG4pID0+IHtcbiAgICAgICAgbWFwW25dLnRpbGUuc2V0U3RhdHVzKCdkZWZhdWx0Jyk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSxcblxuICBfcGxheWVyQWN0aW9uSGFuZGxlcjogZnVuY3Rpb24gKGFjdGlvbiwgbG9jLCBwYXJhbXMpIHtcbiAgICBpZiAoYWN0aW9uID09PSAnc2VsZWN0Jykge1xuICAgICAgdGhpcy5fc2VsZWN0Q2hhcmFjdGVyKHRoaXMucGxheWVyTWFwW2xvY10uY2hhcmFjdGVyKTtcbiAgICB9IGVsc2UgaWYgKGFjdGlvbiA9PT0gJ21vdmUnKSB7XG4gICAgICB0aGlzLl9lbmFibGVNb3ZlKGxvYyk7XG4gICAgfSBlbHNlIGlmIChhY3Rpb24gPT09ICdhdHRhY2snKSB7XG4gICAgICBjb25zb2xlLmxvZyhhY3Rpb24sIGxvYywgcGFyYW1zKTtcbiAgICAgIHRoaXMuX2VuYWJsZVRhcmdldGluZyhsb2MsIHBhcmFtcy5yYW5nZSk7XG4gICAgfVxuICB9LFxuXG4gIF9lbmVteUFjdGlvbkhhbmRsZXI6IGZ1bmN0aW9uIChhY3Rpb24sIGxvYykge1xuICAgIGlmIChhY3Rpb24gPT09ICdraWxsJykge1xuICAgICAgdGhpcy5fa2lsbENoYXJhY3Rlcih0aGlzLmVuZW15TWFwLCBsb2MpO1xuICAgIH1cbiAgfSxcblxuICBfa2lsbENoYXJhY3RlcjogZnVuY3Rpb24gKG1hcCwgbG9jKSB7XG4gICAgbWFwW2xvY10uY2hhcmFjdGVyID0gbnVsbDtcbiAgfSxcbn07XG4iLCJ2YXIgTWVudSA9IGZ1bmN0aW9uICgpIHtcbiAgdGhpcy50ZXh0ID0gbnVsbDtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gTWVudTtcblxuTWVudS5wcm90b3R5cGUgPSB7XG5cbiAgY3JlYXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHggPSB0aGlzLmdhbWUud2lkdGggLyAyO1xuICAgIHZhciB5ID0gdGhpcy5nYW1lLmhlaWdodCAvIDI7XG5cbiAgICB2YXIgc3R5bGUgPSB7IGZvbnQ6IFwiNjVweCBBcmlhbFwiLCBmaWxsOiBcIiNmZmZmZmZcIiwgYWxpZ246IFwiY2VudGVyXCIgfTtcblxuICAgIHRoaXMudGV4dCA9IHRoaXMuYWRkLnRleHQoeCAtIDMwMCwgeSAtIDIwMCwgXCJQcmVzcyB0byBTdGFydFwiLCBzdHlsZSk7XG5cbiAgICB0aGlzLmlucHV0Lm9uRG93bi5hZGQodGhpcy5vbkRvd24sIHRoaXMpO1xuICB9LFxuXG4gIHVwZGF0ZTogZnVuY3Rpb24gKCkge1xuICB9LFxuXG4gIG9uRG93bjogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuZ2FtZS5zdGF0ZS5zdGFydChwbGF5ZXJTdGF0ZS5jdXJyZW50TGV2ZWwpO1xuICB9XG59O1xuIiwidmFyIFByZWxvYWRlciA9IGZ1bmN0aW9uIChnYW1lKSB7XG4gIHRoaXMuYXNzZXQgPSBudWxsO1xuICB0aGlzLnJlYWR5ID0gZmFsc2U7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFByZWxvYWRlcjtcblxuUHJlbG9hZGVyLnByb3RvdHlwZSA9IHtcblxuICBwcmVsb2FkOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5hc3NldCA9IHRoaXMuYWRkLnNwcml0ZSgzMjAsIDI0MCwgJ3ByZWxvYWRlcicpO1xuICAgIHRoaXMuYXNzZXQuYW5jaG9yLnNldFRvKDAuNSwgMC41KTtcblxuICAgIHRoaXMubG9hZC5vbkxvYWRDb21wbGV0ZS5hZGRPbmNlKHRoaXMub25Mb2FkQ29tcGxldGUsIHRoaXMpO1xuICAgIHRoaXMubG9hZC5zZXRQcmVsb2FkU3ByaXRlKHRoaXMuYXNzZXQpO1xuXG4gICAgLyogbG9hZGluZyBzcHJpdGVzICovXG4gICAgdGhpcy5sb2FkLmltYWdlKCdhbGx5JywgJ2Fzc2V0cy9hbGx5LnBuZycpO1xuICAgIHRoaXMubG9hZC5pbWFnZSgnZW5lbXknLCAnYXNzZXRzL2VuZW15LnBuZycpO1xuXG4gICAgLyogbG9hZGluZyB0ZXh0dXJlIGF0bGFzZXMgKi9cbiAgICB0aGlzLmxvYWQuYXRsYXNKU09OSGFzaCgndGlsZXMnLCAnYXNzZXRzL3RpbGVzLnBuZycsICdhc3NldHMvdGlsZXMuanNvbicpO1xuICB9LFxuXG4gIGNyZWF0ZTogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuYXNzZXQuY3JvcEVuYWJsZWQgPSBmYWxzZTtcbiAgfSxcblxuICB1cGRhdGU6IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoISF0aGlzLnJlYWR5KSB7XG4gICAgICB0aGlzLmdhbWUuc3RhdGUuc3RhcnQoJ0dhbWUnLCB0cnVlLCBmYWxzZSwgeyB0ZXN0OiAxIH0pO1xuICAgIH1cbiAgfSxcblxuICBvbkxvYWRDb21wbGV0ZTogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMucmVhZHkgPSB0cnVlO1xuICB9LFxufTtcbiIsInZhciBTcGxhc2ggPSBmdW5jdGlvbiAoKSB7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFNwbGFzaDtcblxuU3BsYXNoLnByb3RvdHlwZSA9IHtcbiAgY3JlYXRlOiBmdW5jdGlvbiAoKSB7XG4gIH1cbn07IiwidmFyIFV0aWxzID0ge1xuICAgIGNvbnRhaW5zT2JqZWN0OiBmdW5jdGlvbihvYmosIGxpc3QpIHtcbiAgICAgICAgdmFyIGk7XG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAobGlzdFtpXSA9PT0gb2JqKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBVdGlsczsiXX0=
